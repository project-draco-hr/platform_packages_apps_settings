{
  AccessibilityManager accessibilityManager=(AccessibilityManager)getSystemService(Service.ACCESSIBILITY_SERVICE);
  List<ServiceInfo> installedServices=accessibilityManager.getAccessibilityServiceList();
  if (installedServices.isEmpty()) {
    getPreferenceScreen().removePreference(mAccessibilityServicesCategory);
    return;
  }
  getPreferenceScreen().addPreference(mAccessibilityServicesCategory);
  for (int i=0, count=installedServices.size(); i < count; ++i) {
    ServiceInfo serviceInfo=installedServices.get(i);
    String key=serviceInfo.packageName + "/" + serviceInfo.name;
    if (mAccessibilityServices.put(key,serviceInfo) == null) {
      CheckBoxPreference preference=new CheckBoxPreference(getActivity());
      preference.setKey(key);
      preference.setTitle(serviceInfo.loadLabel(getActivity().getPackageManager()));
      mAccessibilityServicesCategory.addPreference(preference);
    }
  }
}
