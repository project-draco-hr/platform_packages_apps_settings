{
  final TelephonyManager tm=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);
  final String mccmnc=mSubscriptionInfo == null ? "" : tm.getSimOperator(mSubscriptionInfo.getSubscriptionId());
  Log.d(TAG,"mccmnc = " + mccmnc);
  final String where="numeric=\"" + mccmnc + "\"";
  Cursor cursor=getContentResolver().query(Telephony.Carriers.CONTENT_URI,new String[]{"_id","name","apn","type"},where,null,Telephony.Carriers.DEFAULT_SORT_ORDER);
  if (cursor != null) {
    PreferenceGroup apnList=(PreferenceGroup)findPreference("apn_list");
    apnList.removeAll();
    ArrayList<Preference> mmsApnList=new ArrayList<Preference>();
    mSelectedKey=getSelectedApnKey();
    cursor.moveToFirst();
    while (!cursor.isAfterLast()) {
      String name=cursor.getString(NAME_INDEX);
      String apn=cursor.getString(APN_INDEX);
      String key=cursor.getString(ID_INDEX);
      String type=cursor.getString(TYPES_INDEX);
      ApnPreference pref=new ApnPreference(getActivity());
      pref.setKey(key);
      pref.setTitle(name);
      pref.setSummary(apn);
      pref.setPersistent(false);
      pref.setOnPreferenceChangeListener(this);
      boolean selectable=((type == null) || !type.equals("mms"));
      pref.setSelectable(selectable);
      if (selectable) {
        if ((mSelectedKey != null) && mSelectedKey.equals(key)) {
          pref.setChecked();
        }
        apnList.addPreference(pref);
      }
 else {
        mmsApnList.add(pref);
      }
      cursor.moveToNext();
    }
    cursor.close();
    for (    Preference preference : mmsApnList) {
      apnList.addPreference(preference);
    }
  }
}
