{
  super.onCreate(savedInstanceState);
  mDPM=(DevicePolicyManager)getSystemService(Context.DEVICE_POLICY_SERVICE);
  mKeyStore=KeyStore.getInstance();
  mChooseLockSettingsHelper=new ChooseLockSettingsHelper(this.getActivity());
  final boolean confirmCredentials=getActivity().getIntent().getBooleanExtra(CONFIRM_CREDENTIALS,true);
  if (getActivity() instanceof ChooseLockGeneric.InternalActivity) {
    mPasswordConfirmed=!confirmCredentials;
  }
  if (savedInstanceState != null) {
    mPasswordConfirmed=savedInstanceState.getBoolean(PASSWORD_CONFIRMED);
    mWaitingForConfirmation=savedInstanceState.getBoolean(WAITING_FOR_CONFIRMATION);
    mFinishPending=savedInstanceState.getBoolean(FINISH_PENDING);
  }
  if (mPasswordConfirmed) {
    updatePreferencesOrFinish();
  }
 else   if (!mWaitingForConfirmation) {
    ChooseLockSettingsHelper helper=new ChooseLockSettingsHelper(this.getActivity(),this);
    if (!helper.launchConfirmationActivity(CONFIRM_EXISTING_REQUEST,null,null)) {
      mPasswordConfirmed=true;
      updatePreferencesOrFinish();
    }
 else {
      mWaitingForConfirmation=true;
    }
  }
}
