{
  if (mDone)   return;
  LockPatternUtils utils=mChooseLockSettingsHelper.utils();
  final boolean lockVirgin=!utils.isPatternEverChosen();
  final boolean isFallback=getActivity().getIntent().getBooleanExtra(LockPatternUtils.LOCKSCREEN_BIOMETRIC_WEAK_FALLBACK,false);
  boolean wasSecureBefore=utils.isSecure();
  final boolean required=getActivity().getIntent().getBooleanExtra(EncryptionInterstitial.EXTRA_REQUIRE_PASSWORD,true);
  utils.setCredentialRequiredToDecrypt(required);
  utils.setLockPatternEnabled(true);
  utils.saveLockPattern(mChosenPattern,isFallback);
  if (lockVirgin) {
    utils.setVisiblePatternEnabled(true);
  }
  if (!wasSecureBefore) {
    startActivity(getRedactionInterstitialIntent(getActivity()));
  }
  getActivity().setResult(RESULT_FINISHED);
  getActivity().finish();
  mDone=true;
}
