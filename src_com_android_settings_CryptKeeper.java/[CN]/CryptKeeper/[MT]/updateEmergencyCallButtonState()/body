{
  final Button emergencyCall=(Button)findViewById(R.id.emergencyCallButton);
  if (emergencyCall == null)   return;
  if (isEmergencyCallCapable()) {
    emergencyCall.setVisibility(View.VISIBLE);
    emergencyCall.setOnClickListener(new View.OnClickListener(){
      @Override public void onClick(      View v){
        takeEmergencyCallAction();
      }
    }
);
  }
 else {
    emergencyCall.setVisibility(View.GONE);
    return;
  }
  final int newState=getTelephonyManager().getCallState();
  int textId;
  if (newState == TelephonyManager.CALL_STATE_OFFHOOK) {
    textId=R.string.cryptkeeper_return_to_call;
    final int phoneCallIcon=R.drawable.stat_sys_phone_call;
    emergencyCall.setCompoundDrawablesWithIntrinsicBounds(phoneCallIcon,0,0,0);
  }
 else {
    textId=R.string.cryptkeeper_emergency_call;
    final int emergencyIcon=R.drawable.ic_emergency;
    emergencyCall.setCompoundDrawablesWithIntrinsicBounds(emergencyIcon,0,0,0);
  }
  emergencyCall.setText(textId);
}
