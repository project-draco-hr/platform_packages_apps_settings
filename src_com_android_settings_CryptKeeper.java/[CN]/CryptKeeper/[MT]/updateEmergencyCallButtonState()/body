{
  Button button=(Button)findViewById(R.id.emergencyCallButton);
  if (button == null)   return;
  if (isEmergencyCallCapable()) {
    button.setVisibility(View.VISIBLE);
    button.setOnClickListener(new View.OnClickListener(){
      public void onClick(      View v){
        takeEmergencyCallAction();
      }
    }
);
  }
 else {
    button.setVisibility(View.GONE);
    return;
  }
  int newState=TelephonyManager.getDefault().getCallState();
  int textId;
  if (newState == TelephonyManager.CALL_STATE_OFFHOOK) {
    textId=R.string.cryptkeeper_return_to_call;
    int phoneCallIcon=R.drawable.stat_sys_phone_call;
    button.setCompoundDrawablesWithIntrinsicBounds(phoneCallIcon,0,0,0);
  }
 else {
    textId=R.string.cryptkeeper_emergency_call;
    int emergencyIcon=R.drawable.ic_emergency;
    button.setCompoundDrawablesWithIntrinsicBounds(emergencyIcon,0,0,0);
  }
  button.setText(textId);
}
