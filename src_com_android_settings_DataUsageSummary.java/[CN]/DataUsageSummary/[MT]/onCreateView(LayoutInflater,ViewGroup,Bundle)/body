{
  final Context context=inflater.getContext();
  final View view=inflater.inflate(R.layout.data_usage_summary,container,false);
  mUidDetailProvider=new UidDetailProvider(context);
  mTabHost=(TabHost)view.findViewById(android.R.id.tabhost);
  mTabsContainer=(ViewGroup)view.findViewById(R.id.tabs_container);
  mTabWidget=(TabWidget)view.findViewById(android.R.id.tabs);
  mListView=(ListView)view.findViewById(android.R.id.list);
  final boolean shouldInset=mListView.getScrollBarStyle() == View.SCROLLBARS_OUTSIDE_OVERLAY;
  mInsetSide=0;
  prepareCustomPreferencesList(container,view,mListView,false);
  mTabHost.setup();
  mTabHost.setOnTabChangedListener(mTabListener);
  mHeader=(ViewGroup)inflater.inflate(R.layout.data_usage_header,mListView,false);
  mHeader.setClickable(true);
  mListView.addHeaderView(new View(context),null,true);
  mListView.addHeaderView(mHeader,null,true);
  mListView.setItemsCanFocus(true);
  if (mInsetSide > 0) {
    insetListViewDrawables(mListView,mInsetSide);
    mHeader.setPaddingRelative(mInsetSide,0,mInsetSide,0);
  }
{
    mNetworkSwitchesContainer=(ViewGroup)mHeader.findViewById(R.id.network_switches_container);
    mNetworkSwitches=(LinearLayout)mHeader.findViewById(R.id.network_switches);
    mDataEnabled=new Switch(inflater.getContext());
    mDataEnabledView=inflatePreference(inflater,mNetworkSwitches,mDataEnabled);
    mDataEnabledView.setTag("data_usage_enable_mobile");
    mDataEnabled.setOnCheckedChangeListener(mDataEnabledListener);
    mNetworkSwitches.addView(mDataEnabledView);
    mDisableAtLimit=new CheckBox(inflater.getContext());
    mDisableAtLimit.setClickable(false);
    mDisableAtLimit.setFocusable(false);
    mDisableAtLimitView=inflatePreference(inflater,mNetworkSwitches,mDisableAtLimit);
    mDisableAtLimitView.setTag("data_usage_disable_mobile_limit");
    mDisableAtLimitView.setClickable(true);
    mDisableAtLimitView.setFocusable(true);
    mDisableAtLimitView.setOnClickListener(mDisableAtLimitListener);
    mNetworkSwitches.addView(mDisableAtLimitView);
  }
  mCycleView=mHeader.findViewById(R.id.cycles);
  mCycleView.setTag("data_usage_cycle");
  mCycleSpinner=(Spinner)mCycleView.findViewById(R.id.cycles_spinner);
  mCycleAdapter=new CycleAdapter(context);
  mCycleSpinner.setAdapter(mCycleAdapter);
  mCycleSpinner.setOnItemSelectedListener(mCycleListener);
  mChart=(ChartDataUsageView)mHeader.findViewById(R.id.chart);
  mChart.setListener(mChartListener);
  mChart.bindNetworkPolicy(null);
{
    mAppDetail=mHeader.findViewById(R.id.app_detail);
    mAppIcon=(ImageView)mAppDetail.findViewById(R.id.app_icon);
    mAppTitles=(ViewGroup)mAppDetail.findViewById(R.id.app_titles);
    mAppPieChart=(PieChartView)mAppDetail.findViewById(R.id.app_pie_chart);
    mAppForeground=(TextView)mAppDetail.findViewById(R.id.app_foreground);
    mAppBackground=(TextView)mAppDetail.findViewById(R.id.app_background);
    mAppSwitches=(LinearLayout)mAppDetail.findViewById(R.id.app_switches);
    mAppSettings=(Button)mAppDetail.findViewById(R.id.app_settings);
    mAppSettings.setOnClickListener(mAppSettingsListener);
    mAppRestrict=new CheckBox(inflater.getContext());
    mAppRestrict.setClickable(false);
    mAppRestrict.setFocusable(false);
    mAppRestrictView=inflatePreference(inflater,mAppSwitches,mAppRestrict);
    mAppRestrictView.setClickable(true);
    mAppRestrictView.setFocusable(true);
    mAppRestrictView.setOnClickListener(mAppRestrictListener);
    mAppSwitches.addView(mAppRestrictView);
  }
  mUsageSummary=(TextView)mHeader.findViewById(R.id.usage_summary);
  mEmpty=(TextView)mHeader.findViewById(android.R.id.empty);
  mAdapter=new DataUsageAdapter(mUidDetailProvider,mInsetSide);
  mListView.setOnItemClickListener(mListListener);
  mListView.setAdapter(mAdapter);
  return view;
}
