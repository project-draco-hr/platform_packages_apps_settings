{
  final Context context=inflater.getContext();
  final View view=inflater.inflate(R.layout.data_usage_summary,container,false);
  mUidDetailProvider=new UidDetailProvider(context);
  mTabHost=(TabHost)view.findViewById(android.R.id.tabhost);
  mTabsContainer=(ViewGroup)view.findViewById(R.id.tabs_container);
  mTabWidget=(TabWidget)view.findViewById(android.R.id.tabs);
  mListView=(ListView)view.findViewById(android.R.id.list);
  final boolean shouldInset=mListView.getScrollBarStyle() == View.SCROLLBARS_OUTSIDE_OVERLAY;
  mInsetSide=0;
  prepareCustomPreferencesList(container,view,mListView,false);
  mTabHost.setup();
  mTabHost.setOnTabChangedListener(mTabListener);
  mHeader=(ViewGroup)inflater.inflate(R.layout.data_usage_header,mListView,false);
  mHeader.setClickable(true);
  mListView.addHeaderView(new View(context),null,true);
  mListView.addHeaderView(mHeader,null,true);
  mListView.setItemsCanFocus(true);
  if (mInsetSide > 0) {
    insetListViewDrawables(mListView,mInsetSide);
    mHeader.setPaddingRelative(mInsetSide,0,mInsetSide,0);
  }
{
    mNetworkSwitchesContainer=(ViewGroup)mHeader.findViewById(R.id.network_switches_container);
    mNetworkSwitches=(LinearLayout)mHeader.findViewById(R.id.network_switches);
    mDataEnabled=new Switch(inflater.getContext());
    mDataEnabled.setClickable(false);
    mDataEnabled.setFocusable(false);
    mDataEnabledView=inflatePreference(inflater,mNetworkSwitches,mDataEnabled);
    mDataEnabledView.setTag(R.id.preference_highlight_key,DATA_USAGE_ENABLE_MOBILE_KEY);
    mDataEnabledView.setClickable(true);
    mDataEnabledView.setFocusable(true);
    mDataEnabledView.setOnClickListener(mDataEnabledListener);
    mNetworkSwitches.addView(mDataEnabledView);
    mDisableAtLimit=new Switch(inflater.getContext());
    mDisableAtLimit.setClickable(false);
    mDisableAtLimit.setFocusable(false);
    mDisableAtLimitView=inflatePreference(inflater,mNetworkSwitches,mDisableAtLimit);
    mDisableAtLimitView.setTag(R.id.preference_highlight_key,DATA_USAGE_DISABLE_MOBILE_LIMIT_KEY);
    mDisableAtLimitView.setClickable(true);
    mDisableAtLimitView.setFocusable(true);
    mDisableAtLimitView.setOnClickListener(mDisableAtLimitListener);
    mNetworkSwitches.addView(mDisableAtLimitView);
    mCycleView=inflater.inflate(R.layout.data_usage_cycles,mNetworkSwitches,false);
    mCycleView.setTag(R.id.preference_highlight_key,DATA_USAGE_CYCLE_KEY);
    mCycleSpinner=(Spinner)mCycleView.findViewById(R.id.cycles_spinner);
    mCycleAdapter=new CycleAdapter(context);
    mCycleSpinner.setAdapter(mCycleAdapter);
    mCycleSpinner.setOnItemSelectedListener(mCycleListener);
    mCycleSummary=(TextView)mCycleView.findViewById(R.id.cycle_summary);
    mNetworkSwitches.addView(mCycleView);
  }
  mChart=(ChartDataUsageView)mHeader.findViewById(R.id.chart);
  mChart.setListener(mChartListener);
  mChart.bindNetworkPolicy(null);
{
    mAppDetail=mHeader.findViewById(R.id.app_detail);
    mAppIcon=(ImageView)mAppDetail.findViewById(R.id.app_icon);
    mAppTitles=(ViewGroup)mAppDetail.findViewById(R.id.app_titles);
    mAppForeground=(TextView)mAppDetail.findViewById(R.id.app_foreground);
    mAppBackground=(TextView)mAppDetail.findViewById(R.id.app_background);
    mAppSwitches=(LinearLayout)mAppDetail.findViewById(R.id.app_switches);
    mAppSettings=(Button)mAppDetail.findViewById(R.id.app_settings);
    mAppSettings.setOnClickListener(mAppSettingsListener);
    mAppRestrict=new Switch(inflater.getContext());
    mAppRestrict.setClickable(false);
    mAppRestrict.setFocusable(false);
    mAppRestrictView=inflatePreference(inflater,mAppSwitches,mAppRestrict);
    mAppRestrictView.setClickable(true);
    mAppRestrictView.setFocusable(true);
    mAppRestrictView.setOnClickListener(mAppRestrictListener);
    mAppSwitches.addView(mAppRestrictView);
  }
  mDisclaimer=mHeader.findViewById(R.id.disclaimer);
  mEmpty=(TextView)mHeader.findViewById(android.R.id.empty);
  mStupidPadding=mHeader.findViewById(R.id.stupid_padding);
  mAdapter=new DataUsageAdapter(mUidDetailProvider,mInsetSide);
  mListView.setOnItemClickListener(mListListener);
  mListView.setAdapter(mAdapter);
  return view;
}
