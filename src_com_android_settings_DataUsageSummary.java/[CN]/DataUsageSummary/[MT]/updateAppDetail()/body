{
  final Context context=getActivity();
  final PackageManager pm=context.getPackageManager();
  final LayoutInflater inflater=getActivity().getLayoutInflater();
  if (isAppDetailMode()) {
    mAppDetail.setVisibility(View.VISIBLE);
    mCycleAdapter.setChangeVisible(false);
  }
 else {
    mAppDetail.setVisibility(View.GONE);
    mCycleAdapter.setChangeVisible(true);
    mChart.bindDetailNetworkStats(null);
    return;
  }
  mChart.bindNetworkPolicy(null);
  final int uid=mCurrentApp.key;
  final UidDetail detail=mUidDetailProvider.getUidDetail(uid,true);
  mAppIcon.setImageDrawable(detail.icon);
  mAppTitles.removeAllViews();
  View title=null;
  if (detail.detailLabels != null) {
    final int n=detail.detailLabels.length;
    for (int i=0; i < n; ++i) {
      CharSequence label=detail.detailLabels[i];
      CharSequence contentDescription=detail.detailContentDescriptions[i];
      title=inflater.inflate(R.layout.data_usage_app_title,mAppTitles,false);
      TextView appTitle=(TextView)title.findViewById(R.id.app_title);
      appTitle.setText(label);
      appTitle.setContentDescription(contentDescription);
      mAppTitles.addView(title);
    }
  }
 else {
    title=inflater.inflate(R.layout.data_usage_app_title,mAppTitles,false);
    TextView appTitle=(TextView)title.findViewById(R.id.app_title);
    appTitle.setText(detail.label);
    appTitle.setContentDescription(detail.contentDescription);
    mAppTitles.addView(title);
  }
  if (title != null) {
    mAppTotal=(TextView)title.findViewById(R.id.app_summary);
  }
 else {
    mAppTotal=null;
  }
  final String[] packageNames=pm.getPackagesForUid(uid);
  if (packageNames != null && packageNames.length > 0) {
    mAppSettingsIntent=new Intent(Intent.ACTION_MANAGE_NETWORK_USAGE);
    mAppSettingsIntent.addCategory(Intent.CATEGORY_DEFAULT);
    boolean matchFound=false;
    for (    String packageName : packageNames) {
      mAppSettingsIntent.setPackage(packageName);
      if (pm.resolveActivity(mAppSettingsIntent,0) != null) {
        matchFound=true;
        break;
      }
    }
    mAppSettings.setOnClickListener(new OnClickListener(){
      @Override public void onClick(      View v){
        if (!isAdded()) {
          return;
        }
        getActivity().startActivityAsUser(mAppSettingsIntent,new UserHandle(UserHandle.getUserId(uid)));
      }
    }
);
    mAppSettings.setEnabled(matchFound);
    mAppSettings.setVisibility(View.VISIBLE);
  }
 else {
    mAppSettingsIntent=null;
    mAppSettings.setOnClickListener(null);
    mAppSettings.setVisibility(View.GONE);
  }
  updateDetailData();
  if (UserHandle.isApp(uid) && !mPolicyManager.getRestrictBackground() && isBandwidthControlEnabled()&& hasReadyMobileRadio(context)) {
    setPreferenceTitle(mAppRestrictView,R.string.data_usage_app_restrict_background);
    setPreferenceSummary(mAppRestrictView,getString(R.string.data_usage_app_restrict_background_summary));
    mAppRestrictView.setVisibility(View.VISIBLE);
    mAppRestrict.setChecked(getAppRestrictBackground());
  }
 else {
    mAppRestrictView.setVisibility(View.GONE);
  }
}
