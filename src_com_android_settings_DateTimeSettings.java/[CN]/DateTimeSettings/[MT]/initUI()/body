{
  boolean autoEnabled=getAutoState();
  mDummyDate=Calendar.getInstance();
  mDummyDate.set(mDummyDate.get(Calendar.YEAR),11,31,13,0,0);
  mAutoPref=(CheckBoxPreference)findPreference(KEY_AUTO_TIME);
  mAutoPref.setChecked(autoEnabled);
  mTimePref=findPreference("time");
  mTime24Pref=findPreference("24 hour");
  mTimeZone=findPreference("timezone");
  mDatePref=findPreference("date");
  mDateFormat=(ListPreference)findPreference(KEY_DATE_FORMAT);
  int currentFormatIndex=-1;
  String[] dateFormats=getResources().getStringArray(R.array.date_format_values);
  String[] formattedDates=new String[dateFormats.length];
  String currentFormat=getDateFormat();
  if (currentFormat == null) {
    currentFormat=getResources().getString(R.string.default_date_format);
    setDateFormat(currentFormat);
  }
  for (int i=0; i < formattedDates.length; i++) {
    formattedDates[i]=DateFormat.format(dateFormats[i],mDummyDate).toString();
    if (currentFormat.equals(dateFormats[i]))     currentFormatIndex=i;
  }
  mDateFormat.setEntries(formattedDates);
  mDateFormat.setEntryValues(R.array.date_format_values);
  mDateFormat.setValue(currentFormat);
  mTimePref.setEnabled(!autoEnabled);
  mDatePref.setEnabled(!autoEnabled);
  mTimeZone.setEnabled(!autoEnabled);
  getPreferenceScreen().getSharedPreferences().registerOnSharedPreferenceChangeListener(this);
}
