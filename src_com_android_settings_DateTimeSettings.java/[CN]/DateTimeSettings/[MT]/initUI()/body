{
  boolean autoTimeEnabled=getAutoState(Settings.Global.AUTO_TIME);
  boolean autoTimeZoneEnabled=getAutoState(Settings.Global.AUTO_TIME_ZONE);
  Intent intent=getActivity().getIntent();
  boolean isFirstRun=intent.getBooleanExtra(EXTRA_IS_FIRST_RUN,false);
  mDummyDate=Calendar.getInstance();
  mAutoTimePref=(CheckBoxPreference)findPreference(KEY_AUTO_TIME);
  mAutoTimePref.setChecked(autoTimeEnabled);
  mAutoTimeZonePref=(CheckBoxPreference)findPreference(KEY_AUTO_TIME_ZONE);
  if (Utils.isWifiOnly(getActivity()) || isFirstRun) {
    getPreferenceScreen().removePreference(mAutoTimeZonePref);
    autoTimeZoneEnabled=false;
  }
  mAutoTimeZonePref.setChecked(autoTimeZoneEnabled);
  mTimePref=findPreference("time");
  mTime24Pref=findPreference("24 hour");
  mTimeZone=findPreference("timezone");
  mDatePref=findPreference("date");
  mDateFormat=(ListPreference)findPreference(KEY_DATE_FORMAT);
  if (isFirstRun) {
    getPreferenceScreen().removePreference(mTime24Pref);
    getPreferenceScreen().removePreference(mDateFormat);
  }
  String[] dateFormats=getResources().getStringArray(R.array.date_format_values);
  String[] formattedDates=new String[dateFormats.length];
  String currentFormat=getDateFormat();
  if (currentFormat == null) {
    currentFormat="";
  }
  for (int i=0; i < formattedDates.length; i++) {
    String formatted=DateFormat.getDateFormatForSetting(getActivity(),dateFormats[i]).format(mDummyDate.getTime());
    if (dateFormats[i].length() == 0) {
      formattedDates[i]=getResources().getString(R.string.normal_date_format,formatted);
    }
 else {
      formattedDates[i]=formatted;
    }
  }
  mDateFormat.setEntries(formattedDates);
  mDateFormat.setEntryValues(R.array.date_format_values);
  mDateFormat.setValue(currentFormat);
  mTimePref.setEnabled(!autoTimeEnabled);
  mDatePref.setEnabled(!autoTimeEnabled);
  mTimeZone.setEnabled(!autoTimeZoneEnabled);
}
