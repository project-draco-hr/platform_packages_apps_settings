{
  final ComponentName bugreportStorageProviderComponentName=new ComponentName("com.android.shell","com.android.shell.BugreportStorageProvider");
  if ("user".equals(Build.TYPE)) {
    final ContentResolver resolver=getActivity().getContentResolver();
    final boolean adbEnabled=Settings.Global.getInt(resolver,Settings.Global.ADB_ENABLED,0) != 0;
    if (adbEnabled) {
      mBugreport.setEnabled(true);
      mBugreportInPower.setEnabled(true);
      getPackageManager().setComponentEnabledSetting(bugreportStorageProviderComponentName,PackageManager.COMPONENT_ENABLED_STATE_ENABLED,0);
    }
 else {
      mBugreport.setEnabled(false);
      mBugreportInPower.setEnabled(false);
      mBugreportInPower.setChecked(false);
      Settings.Secure.putInt(resolver,Settings.Secure.BUGREPORT_IN_POWER_MENU,0);
      getPackageManager().setComponentEnabledSetting(bugreportStorageProviderComponentName,PackageManager.COMPONENT_ENABLED_STATE_DEFAULT,0);
    }
  }
 else {
    mBugreportInPower.setEnabled(true);
    getPackageManager().setComponentEnabledSetting(bugreportStorageProviderComponentName,PackageManager.COMPONENT_ENABLED_STATE_ENABLED,0);
  }
}
