{
  super(context,attrs);
  mContext=context;
  mAdapter=new ArrayAdapter<String>(mContext,android.R.layout.simple_spinner_dropdown_item);
  mSpinner=new Spinner(mContext);
  mSpinner.setVisibility(View.INVISIBLE);
  mSpinner.setAdapter(mAdapter);
  mSpinner.setOnItemSelectedListener(new OnItemSelectedListener(){
    @Override public void onItemSelected(    AdapterView<?> parent,    View v,    int position,    long id){
      setSelectedItem(position);
    }
    @Override public void onNothingSelected(    AdapterView<?> parent){
    }
  }
);
  setPersistent(false);
  setOnPreferenceClickListener(new OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      mSpinner.performClick();
      return true;
    }
  }
);
  TypedArray a=context.obtainStyledAttributes(attrs,R.styleable.DropDownPreference);
  CharSequence[] entries=a.getTextArray(R.styleable.DropDownPreference_android_entries);
  CharSequence[] values=a.getTextArray(R.styleable.DropDownPreference_android_entryValues);
  if (entries != null && values != null) {
    for (int i=0; i < entries.length; i++) {
      addItem(entries[i].toString(),values[i]);
    }
  }
}
