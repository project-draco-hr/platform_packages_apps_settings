{
  List<GadgetProviderInfo> installed=mGadgetManager.getInstalledProviders();
  PackageManager pm=getPackageManager();
  Drawable defaultIcon=null;
  IconResizer resizer=new IconResizer();
  ArrayList<ListItem> result=new ArrayList();
  final int N=installed.size();
  for (int i=0; i < N; i++) {
    GadgetProviderInfo info=installed.get(i);
    LauncherActivity.ListItem item=new LauncherActivity.ListItem();
    item.packageName=info.provider.getPackageName();
    item.className=info.provider.getClassName();
    item.label=info.label;
    if (info.icon != 0) {
      Drawable d=pm.getDrawable(item.packageName,info.icon,null);
      if (d != null) {
        item.icon=resizer.createIconThumbnail(d);
      }
 else {
        Log.w(TAG,"Can't load icon drawable 0x" + Integer.toHexString(info.icon) + " for package: "+ item.packageName);
      }
    }
    if (item.icon == null) {
      if (defaultIcon == null) {
      }
      item.icon=defaultIcon;
    }
    result.add(item);
  }
  Collections.sort(result,new Comparator<ListItem>(){
    Collator mCollator=Collator.getInstance();
    public int compare(    ListItem lhs,    ListItem rhs){
      return mCollator.compare(lhs.label,rhs.label);
    }
  }
);
  return result;
}
