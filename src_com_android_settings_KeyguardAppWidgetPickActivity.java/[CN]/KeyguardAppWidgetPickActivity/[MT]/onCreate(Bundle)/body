{
  setContentView(R.layout.keyguard_appwidget_picker_layout);
  super.onCreate(savedInstanceState);
  setResultData(RESULT_CANCELED,null);
  final Intent intent=getIntent();
  if (intent.hasExtra(AppWidgetManager.EXTRA_APPWIDGET_ID)) {
    mAppWidgetId=intent.getIntExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,AppWidgetManager.INVALID_APPWIDGET_ID);
  }
 else {
    finish();
  }
  mExtraConfigureOptions=intent.getBundleExtra(AppWidgetManager.EXTRA_APPWIDGET_OPTIONS);
  mGridView=(GridView)findViewById(R.id.widget_list);
  DisplayMetrics dm=new DisplayMetrics();
  getWindowManager().getDefaultDisplay().getMetrics(dm);
  int maxGridWidth=getResources().getDimensionPixelSize(R.dimen.keyguard_appwidget_picker_max_width);
  if (maxGridWidth < dm.widthPixels) {
    mGridView.getLayoutParams().width=maxGridWidth;
  }
  mAppWidgetManager=AppWidgetManager.getInstance(this);
  mAppWidgetLoader=new AppWidgetLoader<Item>(this,mAppWidgetManager,this);
  mItems=mAppWidgetLoader.getItems(getIntent());
  mAppWidgetAdapter=new AppWidgetAdapter(this,mItems);
  mGridView.setAdapter(mAppWidgetAdapter);
  mGridView.setOnItemClickListener(this);
  mLockPatternUtils=new LockPatternUtils(this);
}
