{
  InputMethodManager imm=(InputMethodManager)getSystemService(Context.INPUT_METHOD_SERVICE);
  mInputMethodProperties=imm.getInputMethodList();
  mLastInputMethodId=Settings.Secure.getString(getContentResolver(),Settings.Secure.DEFAULT_INPUT_METHOD);
  PreferenceGroup textCategory=(PreferenceGroup)findPreference("text_category");
  int N=(mInputMethodProperties == null ? 0 : mInputMethodProperties.size());
  for (int i=0; i < N; ++i) {
    InputMethodInfo property=mInputMethodProperties.get(i);
    String prefKey=property.getId();
    CharSequence label=property.loadLabel(getPackageManager());
    CheckBoxPreference chkbxPref=new CheckBoxPreference(this);
    chkbxPref.setKey(prefKey);
    chkbxPref.setTitle(label);
    textCategory.addPreference(chkbxPref);
    if (null != property.getSettingsActivity()) {
      PreferenceScreen prefScreen=new PreferenceScreen(this,null);
      prefScreen.setKey(property.getSettingsActivity());
      CharSequence settingsLabel=getResources().getString(R.string.input_methods_settings_label_format,label);
      prefScreen.setTitle(settingsLabel);
      textCategory.addPreference(prefScreen);
    }
  }
}
