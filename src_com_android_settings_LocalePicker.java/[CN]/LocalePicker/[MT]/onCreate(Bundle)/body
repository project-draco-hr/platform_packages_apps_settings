{
  super.onCreate(icicle);
  setContentView(getContentView());
  String[] locales=getAssets().getLocales();
  Arrays.sort(locales);
  final int origSize=locales.length;
  Loc[] preprocess=new Loc[origSize];
  int finalSize=0;
  for (int i=0; i < origSize; i++) {
    String s=locales[i];
    int len=s.length();
    if (len == 2) {
      Locale l=new Locale(s);
      preprocess[finalSize++]=new Loc(l.getDisplayLanguage(),l);
    }
 else     if (len == 5) {
      String language=s.substring(0,2);
      String country=s.substring(3,5);
      Locale l=new Locale(language,country);
      if (finalSize == 0) {
        preprocess[finalSize++]=new Loc(l.getDisplayLanguage(),l);
      }
 else {
        if (preprocess[finalSize - 1].locale.getLanguage().equals(language)) {
          String prevCountry=preprocess[finalSize - 1].locale.getCountry();
          if (prevCountry.length() == 0) {
            preprocess[finalSize - 1].locale=l;
            preprocess[finalSize - 1].label=l.getDisplayLanguage();
          }
 else {
            preprocess[finalSize - 1].label=preprocess[finalSize - 1].locale.getDisplayName();
            preprocess[finalSize++]=new Loc(l.getDisplayName(),l);
          }
        }
 else {
          String displayName;
          if (s.equals("zz_ZZ")) {
            displayName="Pseudo...";
          }
 else {
            displayName=l.getDisplayLanguage();
          }
          preprocess[finalSize++]=new Loc(displayName,l);
        }
      }
    }
  }
  mLocales=new Loc[finalSize];
  for (int i=0; i < finalSize; i++) {
    mLocales[i]=preprocess[i];
  }
  int layoutId=R.layout.locale_picker_item;
  int fieldId=R.id.locale;
  ArrayAdapter<Loc> adapter=new ArrayAdapter<Loc>(this,layoutId,fieldId,mLocales);
  getListView().setAdapter(adapter);
}
