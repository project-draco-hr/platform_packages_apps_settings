{
  super.onCreate(icicle);
  setContentView(getContentView());
  String[] locales=getAssets().getLocales();
  Arrays.sort(locales);
  final int origSize=locales.length;
  Loc[] preprocess=new Loc[origSize];
  int finalSize=0;
  for (int i=0; i < origSize; i++) {
    String s=locales[i];
    int len=s.length();
    if (len == 5) {
      String language=s.substring(0,2);
      String country=s.substring(3,5);
      Locale l=new Locale(language,country);
      if (finalSize == 0) {
        Log.v(TAG,"adding initial " + toTitleCase(l.getDisplayLanguage(l)));
        preprocess[finalSize++]=new Loc(toTitleCase(l.getDisplayLanguage(l)),l);
      }
 else {
        if (preprocess[finalSize - 1].locale.getLanguage().equals(language)) {
          Log.v(TAG,"backing up and fixing " + preprocess[finalSize - 1].label + " to "+ preprocess[finalSize - 1].locale.getDisplayName(l));
          preprocess[finalSize - 1].label=toTitleCase(preprocess[finalSize - 1].locale.getDisplayName(l));
          Log.v(TAG,"  and adding " + toTitleCase(l.getDisplayName(l)));
          preprocess[finalSize++]=new Loc(toTitleCase(l.getDisplayName(l)),l);
        }
 else {
          String displayName;
          if (s.equals("zz_ZZ")) {
            displayName="Pseudo...";
          }
 else {
            displayName=toTitleCase(l.getDisplayLanguage(l));
          }
          Log.v(TAG,"adding " + displayName);
          preprocess[finalSize++]=new Loc(displayName,l);
        }
      }
    }
  }
  mLocales=new Loc[finalSize];
  for (int i=0; i < finalSize; i++) {
    mLocales[i]=preprocess[i];
  }
  Arrays.sort(mLocales);
  int layoutId=R.layout.locale_picker_item;
  int fieldId=R.id.locale;
  ArrayAdapter<Loc> adapter=new ArrayAdapter<Loc>(this,layoutId,fieldId,mLocales);
  getListView().setAdapter(adapter);
}
