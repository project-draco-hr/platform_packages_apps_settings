{
  PreferenceScreen root=getPreferenceScreen();
  if (root != null) {
    root.removeAll();
  }
  addPreferencesFromResource(R.xml.location_settings);
  root=getPreferenceScreen();
  mNetwork=(CheckBoxPreference)root.findPreference(KEY_LOCATION_NETWORK);
  mGps=(CheckBoxPreference)root.findPreference(KEY_LOCATION_GPS);
  mAssistedGps=(CheckBoxPreference)root.findPreference(KEY_ASSISTED_GPS);
  if (GoogleLocationSettingHelper.isAvailable(getActivity())) {
    CheckBoxPreference useLocation=new CheckBoxPreference(getActivity());
    useLocation.setKey(KEY_USE_LOCATION);
    useLocation.setTitle(R.string.use_location_title);
    useLocation.setSummaryOn(R.string.use_location_summary_enabled);
    useLocation.setSummaryOff(R.string.use_location_summary_disabled);
    useLocation.setChecked(GoogleLocationSettingHelper.getUseLocationForServices(getActivity()) == GoogleLocationSettingHelper.USE_LOCATION_FOR_SERVICES_ON);
    useLocation.setPersistent(false);
    useLocation.setOnPreferenceChangeListener(this);
    getPreferenceScreen().addPreference(useLocation);
    mUseLocation=useLocation;
  }
  if (Utils.isWifiOnly()) {
    mNetwork.setSummaryOn(R.string.location_neighborhood_level_wifi);
  }
  return root;
}
