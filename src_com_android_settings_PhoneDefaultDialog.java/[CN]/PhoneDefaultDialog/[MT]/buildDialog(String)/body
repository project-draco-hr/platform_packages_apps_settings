{
  final TelephonyManager tm=(TelephonyManager)getSystemService(Context.TELEPHONY_SERVICE);
  if (!tm.isVoiceCapable()) {
    Log.w(TAG,"Dialog launched but device is not voice capable.");
    return false;
  }
  mNewComponent=PhoneApplication.getPhoneApplicationForPackageName(this,packageName);
  if (mNewComponent == null) {
    Log.w(TAG,"Provided package name does not correspond to an installed Phone application.");
    return false;
  }
  final ComponentName oldComponent=PhoneApplication.getDefaultPhoneApplication(this);
  if (oldComponent != null && TextUtils.equals(oldComponent.getPackageName(),mNewComponent.getPackageName())) {
    return false;
  }
  final PackageManager pm=getPackageManager();
  final String newComponentLabel=getApplicationLabelForPackageName(pm,mNewComponent.getPackageName());
  final AlertController.AlertParams p=mAlertParams;
  p.mTitle=getString(R.string.phone_change_default_dialog_title);
  if (oldComponent != null) {
    String oldComponentLabel=getApplicationLabelForPackageName(pm,oldComponent.getPackageName());
    p.mMessage=getString(R.string.sms_change_default_dialog_text,newComponentLabel,oldComponentLabel);
  }
 else {
    p.mMessage=getString(R.string.sms_change_default_no_previous_dialog_text,newComponentLabel);
  }
  p.mPositiveButtonText=getString(R.string.yes);
  p.mNegativeButtonText=getString(R.string.no);
  p.mPositiveButtonListener=this;
  p.mNegativeButtonListener=this;
  setupAlert();
  return true;
}
