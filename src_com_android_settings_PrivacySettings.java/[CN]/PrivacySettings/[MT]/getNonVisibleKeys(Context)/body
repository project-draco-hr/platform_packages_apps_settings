{
  final ArrayList<String> nonVisibleKeys=new ArrayList<String>();
  final IBackupManager backupManager=IBackupManager.Stub.asInterface(ServiceManager.getService(Context.BACKUP_SERVICE));
  boolean isServiceActive=false;
  try {
    isServiceActive=backupManager.isBackupServiceActive(UserHandle.myUserId());
  }
 catch (  RemoteException e) {
    Log.w(TAG,"Failed querying backup manager service activity status. " + "Assuming it is inactive.");
  }
  if (isServiceActive) {
    nonVisibleKeys.add(BACKUP_INACTIVE);
  }
 else {
    nonVisibleKeys.add(AUTO_RESTORE);
    nonVisibleKeys.add(CONFIGURE_ACCOUNT);
    nonVisibleKeys.add(BACKUP_DATA);
  }
  if (UserManager.get(context).hasUserRestriction(UserManager.DISALLOW_FACTORY_RESET)) {
    nonVisibleKeys.add(PERSONAL_DATA_CATEGORY);
  }
  if (context.getPackageManager().resolveContentProvider(GSETTINGS_PROVIDER,0) == null) {
    nonVisibleKeys.add(BACKUP_CATEGORY);
  }
  return nonVisibleKeys;
}
