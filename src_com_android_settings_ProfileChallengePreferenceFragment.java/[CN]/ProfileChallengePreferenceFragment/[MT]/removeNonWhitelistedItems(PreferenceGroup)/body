{
  int numPreferences=prefScreen.getPreferenceCount();
  int i=0;
  while (i < numPreferences) {
    final Preference pref=prefScreen.getPreference(i);
    if (pref instanceof PreferenceCategory) {
      PreferenceCategory category=(PreferenceCategory)pref;
      removeNonWhitelistedItems(category);
      if (category.getPreferenceCount() == 0) {
        prefScreen.removePreference(category);
        --i;
        --numPreferences;
      }
    }
 else     if (ALLOWED_PREFERENCE_KEYS.contains(pref.getKey())) {
      if (SWITCH_PREFERENCE_KEYS.contains(pref.getKey())) {
        pref.setOnPreferenceChangeListener(this);
      }
    }
 else {
      prefScreen.removePreference(pref);
      --i;
      --numPreferences;
    }
    ++i;
  }
}
