{
  String hostname=mHostnameField.getText().toString().trim();
  String portStr=mPortField.getText().toString().trim();
  String exclList=mExclusionListField.getText().toString().trim();
  int port=-1;
  int result=validate(hostname,portStr,exclList);
  if (result > 0) {
    showDialog(ERROR_DIALOG_ID);
    return false;
  }
  if (portStr.length() > 0) {
    try {
      port=Integer.parseInt(portStr);
    }
 catch (    NumberFormatException ex) {
      return false;
    }
  }
  ContentResolver res=getContentResolver();
  if (hostname.equals(Proxy.getDefaultHost()) && port == Proxy.getDefaultPort()) {
    hostname=null;
  }
  if (!TextUtils.isEmpty(hostname)) {
    hostname+=':' + portStr;
  }
  Settings.Secure.putString(res,Settings.Secure.HTTP_PROXY,hostname);
  Settings.Secure.putString(res,Settings.Secure.HTTP_PROXY_EXCLUSION_LIST,exclList);
  sendBroadcast(new Intent(Proxy.PROXY_CHANGE_ACTION));
  return true;
}
