{
  String oldPassword=getText(dialog,R.id.old_password);
  String newPassword=getText(dialog,R.id.new_password);
  String confirmPassword=getText(dialog,R.id.confirm_password);
  if (oldPassword != null && oldPassword.length() == 0) {
    showError(dialog,R.string.credentials_password_empty);
    return false;
  }
 else   if (newPassword == null) {
    return !checkError(dialog,unlock(oldPassword));
  }
 else   if (newPassword.length() == 0 || confirmPassword.length() == 0) {
    showError(dialog,R.string.credentials_passwords_empty);
  }
 else   if (newPassword.length() < MINIMUM_PASSWORD_LENGTH) {
    showError(dialog,R.string.credentials_password_too_short);
  }
 else   if (!newPassword.equals(confirmPassword)) {
    showError(dialog,R.string.credentials_passwords_mismatch);
  }
 else   if (oldPassword == null) {
    initialize(newPassword);
    return true;
  }
 else {
    return !checkError(dialog,changePassword(oldPassword,newPassword));
  }
  return false;
}
