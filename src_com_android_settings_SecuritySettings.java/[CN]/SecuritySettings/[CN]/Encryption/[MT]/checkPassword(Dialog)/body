{
  String newPassword=getText(dialog,R.id.new_password);
  String confirmPassword=getText(dialog,R.id.confirm_password);
  if (newPassword == null || confirmPassword == null || newPassword.length() == 0 || confirmPassword.length() == 0) {
    showError(dialog,R.string.credentials_passwords_empty);
  }
 else   if (!newPassword.equals(confirmPassword)) {
    showError(dialog,R.string.credentials_passwords_mismatch);
  }
 else {
    IBinder service=ServiceManager.getService("mount");
    if (service == null) {
      return false;
    }
    IMountService mountService=IMountService.Stub.asInterface(service);
    try {
      mountService.encryptStorage(newPassword);
    }
 catch (    Exception e) {
      Log.e(TAG,"Error while encrypting...",e);
    }
    return true;
  }
  return false;
}
