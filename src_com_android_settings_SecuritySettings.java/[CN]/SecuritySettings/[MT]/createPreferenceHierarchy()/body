{
  PreferenceScreen root=getPreferenceScreen();
  if (root != null) {
    root.removeAll();
  }
  addPreferencesFromResource(R.xml.security_settings);
  root=getPreferenceScreen();
  mNetwork=(CheckBoxPreference)root.findPreference(KEY_LOCATION_NETWORK);
  mGps=(CheckBoxPreference)root.findPreference(KEY_LOCATION_GPS);
  mAssistedGps=(CheckBoxPreference)root.findPreference(KEY_ASSISTED_GPS);
  if (GoogleLocationSettingHelper.isAvailable(getActivity())) {
    PreferenceGroup locationCat=(PreferenceGroup)root.findPreference(KEY_LOCATION_CATEGORY);
    CheckBoxPreference useLocation=new CheckBoxPreference(getActivity());
    useLocation.setKey(KEY_USE_LOCATION);
    useLocation.setTitle(R.string.use_location_title);
    useLocation.setSummaryOn(R.string.use_location_summary_enabled);
    useLocation.setSummaryOff(R.string.use_location_summary_disabled);
    useLocation.setChecked(GoogleLocationSettingHelper.getUseLocationForServices(getActivity()) == GoogleLocationSettingHelper.USE_LOCATION_FOR_SERVICES_ON);
    useLocation.setPersistent(false);
    useLocation.setOnPreferenceChangeListener(this);
    locationCat.addPreference(useLocation);
    mUseLocation=useLocation;
  }
  int resid=0;
  if (!mLockPatternUtils.isSecure()) {
    if (mLockPatternUtils.isLockScreenDisabled()) {
      resid=R.xml.security_settings_lockscreen;
    }
 else {
      resid=R.xml.security_settings_chooser;
    }
  }
 else {
switch (mLockPatternUtils.getKeyguardStoredPasswordQuality()) {
case DevicePolicyManager.PASSWORD_QUALITY_SOMETHING:
      resid=R.xml.security_settings_pattern;
    break;
case DevicePolicyManager.PASSWORD_QUALITY_NUMERIC:
  resid=R.xml.security_settings_pin;
break;
case DevicePolicyManager.PASSWORD_QUALITY_ALPHABETIC:
case DevicePolicyManager.PASSWORD_QUALITY_ALPHANUMERIC:
case DevicePolicyManager.PASSWORD_QUALITY_COMPLEX:
resid=R.xml.security_settings_password;
break;
}
}
addPreferencesFromResource(resid);
DevicePolicyManager dpm=(DevicePolicyManager)getSystemService(Context.DEVICE_POLICY_SERVICE);
switch (dpm.getStorageEncryptionStatus()) {
case DevicePolicyManager.ENCRYPTION_STATUS_ACTIVE:
addPreferencesFromResource(R.xml.security_settings_encrypted);
break;
case DevicePolicyManager.ENCRYPTION_STATUS_INACTIVE:
addPreferencesFromResource(R.xml.security_settings_unencrypted);
break;
}
mLockAfter=(ListPreference)root.findPreference(KEY_LOCK_AFTER_TIMEOUT);
if (mLockAfter != null) {
setupLockAfterPreference();
updateLockAfterPreferenceSummary();
}
mVisiblePattern=(CheckBoxPreference)root.findPreference(KEY_VISIBLE_PATTERN);
mTactileFeedback=(CheckBoxPreference)root.findPreference(KEY_TACTILE_FEEDBACK_ENABLED);
if (!((Vibrator)getSystemService(Context.VIBRATOR_SERVICE)).hasVibrator()) {
PreferenceGroup securityCategory=(PreferenceGroup)root.findPreference(KEY_SECURITY_CATEGORY);
if (securityCategory != null && mTactileFeedback != null) {
securityCategory.removePreference(mTactileFeedback);
}
}
addPreferencesFromResource(R.xml.security_settings_misc);
if (TelephonyManager.PHONE_TYPE_CDMA == TelephonyManager.getDefault().getPhoneType()) {
root.removePreference(root.findPreference(KEY_SIM_LOCK));
}
mShowPassword=(CheckBoxPreference)root.findPreference(KEY_SHOW_PASSWORD);
mEnableCredentials=(CheckBoxPreference)root.findPreference(KEY_ENABLE_CREDENTIALS);
mEnableCredentials.setOnPreferenceChangeListener(this);
mResetCredentials=root.findPreference(KEY_RESET_CREDENTIALS);
return root;
}
