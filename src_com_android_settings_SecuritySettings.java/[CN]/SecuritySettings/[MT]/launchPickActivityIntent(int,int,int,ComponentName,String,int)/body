{
  Intent pickIntent=new Intent(AppWidgetManager.ACTION_APPWIDGET_PICK);
  final int KEYGUARD_HOST_ID=0x4B455947;
  int appWidgetId=AppWidgetHost.allocateAppWidgetIdForSystem(KEYGUARD_HOST_ID);
  if (appWidgetId != -1) {
    pickIntent.putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID,appWidgetId);
    pickIntent.putExtra(AppWidgetManager.EXTRA_CUSTOM_SORT,false);
    pickIntent.putExtra(AppWidgetManager.EXTRA_CATEGORY_FILTER,AppWidgetProviderInfo.WIDGET_CATEGORY_KEYGUARD);
    if (featuresFilter != AppWidgetProviderInfo.WIDGET_FEATURES_NONE) {
      pickIntent.putExtra(AppWidgetManager.EXTRA_FEATURES_FILTER,featuresFilter);
    }
    AppWidgetProviderInfo defaultInfo=new AppWidgetProviderInfo();
    ArrayList<AppWidgetProviderInfo> extraInfos=new ArrayList<AppWidgetProviderInfo>();
    defaultInfo.label=getResources().getString(defaultLabelId);
    defaultInfo.icon=defaultIconId;
    defaultInfo.provider=defaultComponentName;
    extraInfos.add(defaultInfo);
    ArrayList<Bundle> extraExtras=new ArrayList<Bundle>();
    Bundle b=new Bundle();
    b.putBoolean(defaultTag,true);
    extraExtras.add(b);
    pickIntent.putExtra(AppWidgetManager.EXTRA_CUSTOM_INFO,extraInfos);
    pickIntent.putExtra(AppWidgetManager.EXTRA_CUSTOM_EXTRAS,extraExtras);
    pickIntent.putExtra(Intent.EXTRA_INTENT,getBaseIntent());
    startActivityForResult(pickIntent,widgetType);
  }
 else {
    Log.e(TAG,"Unable to allocate an AppWidget id in lock screen");
  }
}
