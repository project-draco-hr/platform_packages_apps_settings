{
  boolean vibeInSilent=(Settings.System.getInt(getContentResolver(),Settings.System.VIBRATE_IN_SILENT,1) == 1);
  int callsVibrateSetting=mAudioManager.getVibrateSetting(AudioManager.VIBRATE_TYPE_RINGER);
  if (vibeInSilent) {
    if (callsVibrateSetting == AudioManager.VIBRATE_SETTING_OFF) {
      mAudioManager.setVibrateSetting(AudioManager.VIBRATE_TYPE_RINGER,AudioManager.VIBRATE_SETTING_ONLY_SILENT);
    }
    if (callsVibrateSetting == AudioManager.VIBRATE_SETTING_ON) {
      return VALUE_VIBRATE_ALWAYS;
    }
 else {
      return VALUE_VIBRATE_ONLY_SILENT;
    }
  }
 else {
    if (callsVibrateSetting == AudioManager.VIBRATE_SETTING_ONLY_SILENT) {
      mAudioManager.setVibrateSetting(AudioManager.VIBRATE_TYPE_RINGER,AudioManager.VIBRATE_SETTING_OFF);
    }
    if (callsVibrateSetting == AudioManager.VIBRATE_SETTING_ON) {
      return VALUE_VIBRATE_UNLESS_SILENT;
    }
 else {
      return VALUE_VIBRATE_NEVER;
    }
  }
}
