{
  ConnectivityManager cm=(ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);
  if (preference == mUsbTether) {
    boolean newState=mUsbTether.isChecked();
    if (newState) {
      startProvisioningIfNecessary(TETHERING_USB);
    }
 else {
      if (TetherUtil.isProvisioningNeeded(getActivity())) {
        TetherService.cancelRecheckAlarmIfNecessary(getActivity(),TETHERING_USB);
      }
      setUsbTethering(newState);
    }
  }
 else   if (preference == mBluetoothTether) {
    boolean bluetoothTetherState=mBluetoothTether.isChecked();
    if (bluetoothTetherState) {
      startProvisioningIfNecessary(TETHERING_BLUETOOTH);
    }
 else {
      if (TetherUtil.isProvisioningNeeded(getActivity())) {
        TetherService.cancelRecheckAlarmIfNecessary(getActivity(),TETHERING_BLUETOOTH);
      }
      boolean errored=false;
      String[] tethered=cm.getTetheredIfaces();
      String bluetoothIface=findIface(tethered,mBluetoothRegexs);
      if (bluetoothIface != null && cm.untether(bluetoothIface) != ConnectivityManager.TETHER_ERROR_NO_ERROR) {
        errored=true;
      }
      BluetoothPan bluetoothPan=mBluetoothPan.get();
      if (bluetoothPan != null)       bluetoothPan.setBluetoothTethering(false);
      if (errored) {
        mBluetoothTether.setSummary(R.string.bluetooth_tethering_errored_subtext);
      }
 else {
        mBluetoothTether.setSummary(R.string.bluetooth_tethering_off_subtext);
      }
    }
  }
 else   if (preference == mCreateNetwork) {
    showDialog(DIALOG_AP_SETTINGS);
  }
  return super.onPreferenceTreeClick(screen,preference);
}
