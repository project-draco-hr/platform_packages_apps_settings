{
  PreferenceGroup enginesCategory=(PreferenceGroup)findPreference("tts_engines_section");
  Intent intent=new Intent("android.intent.action.START_TTS_ENGINE");
  ResolveInfo[] enginesArray=new ResolveInfo[0];
  PackageManager pm=getPackageManager();
  enginesArray=pm.queryIntentActivities(intent,0).toArray(enginesArray);
  for (int i=0; i < enginesArray.length; i++) {
    String prefKey="";
    final String pluginPackageName=enginesArray[i].activityInfo.packageName;
    if (!enginesArray[i].activityInfo.packageName.equals(SYSTEM_TTS)) {
      CheckBoxPreference chkbxPref=new CheckBoxPreference(context);
      prefKey=KEY_PLUGIN_ENABLED_PREFIX + pluginPackageName;
      chkbxPref.setKey(prefKey);
      chkbxPref.setTitle(enginesArray[i].loadLabel(pm));
      enginesCategory.addPreference(chkbxPref);
    }
    if (pluginHasSettings(pluginPackageName)) {
      Preference pref=new Preference(context);
      prefKey=KEY_PLUGIN_SETTINGS_PREFIX + pluginPackageName;
      pref.setKey(prefKey);
      pref.setTitle(enginesArray[i].loadLabel(pm));
      CharSequence settingsLabel=getResources().getString(R.string.tts_engine_name_settings,enginesArray[i].loadLabel(pm));
      pref.setSummary(settingsLabel);
      pref.setOnPreferenceClickListener(new OnPreferenceClickListener(){
        public boolean onPreferenceClick(        Preference preference){
          Intent i=new Intent();
          i.setClassName(pluginPackageName,pluginPackageName + ".EngineSettings");
          startActivity(i);
          return true;
        }
      }
);
      enginesCategory.addPreference(pref);
    }
  }
}
