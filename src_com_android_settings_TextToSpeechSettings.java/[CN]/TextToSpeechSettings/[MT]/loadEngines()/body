{
  ListPreference enginesPref=(ListPreference)findPreference(KEY_TTS_DEFAULT_SYNTH);
  Intent intent=new Intent("android.intent.action.START_TTS_ENGINE");
  ResolveInfo[] enginesArray=new ResolveInfo[0];
  PackageManager pm=getPackageManager();
  enginesArray=pm.queryIntentActivities(intent,0).toArray(enginesArray);
  ArrayList<CharSequence> entries=new ArrayList<CharSequence>();
  ArrayList<CharSequence> values=new ArrayList<CharSequence>();
  for (int i=0; i < enginesArray.length; i++) {
    if (enginesArray[i].activityInfo.packageName.equals(SYSTEM_TTS)) {
      entries.add(enginesArray[i].loadLabel(pm));
      values.add(enginesArray[i].activityInfo.packageName);
    }
 else {
      CheckBoxPreference pref=(CheckBoxPreference)findPreference(KEY_PLUGIN_ENABLED_PREFIX + enginesArray[i].activityInfo.packageName);
      if ((pref != null) && pref.isChecked()) {
        entries.add(enginesArray[i].loadLabel(pm));
        values.add(enginesArray[i].activityInfo.packageName);
      }
    }
  }
  CharSequence entriesArray[]=new CharSequence[entries.size()];
  CharSequence valuesArray[]=new CharSequence[values.size()];
  enginesPref.setEntries(entries.toArray(entriesArray));
  enginesPref.setEntryValues(values.toArray(valuesArray));
}
