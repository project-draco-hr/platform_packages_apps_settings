{
  Context context=getActivity();
  if (context == null) {
    return;
  }
  loadActiveAgents();
  PackageManager pm=getActivity().getPackageManager();
  Intent trustAgentIntent=new Intent(SERVICE_INTERFACE);
  List<ResolveInfo> resolveInfos=pm.queryIntentServices(trustAgentIntent,PackageManager.GET_META_DATA);
  mAvailableAgents.clear();
  mAvailableAgents.ensureCapacity(resolveInfos.size());
  for (  ResolveInfo resolveInfo : resolveInfos) {
    if (resolveInfo.serviceInfo == null)     continue;
    String packageName=resolveInfo.serviceInfo.packageName;
    if (pm.checkPermission(PERMISSION_PROVIDE_AGENT,packageName) != PackageManager.PERMISSION_GRANTED) {
      Log.w(TAG,"Skipping agent because package " + packageName + " does not have permission "+ PERMISSION_PROVIDE_AGENT+ ".");
      continue;
    }
    ComponentName name=getComponentName(resolveInfo);
    if (!mAvailableAgents.containsKey(name)) {
      AgentInfo agentInfo=new AgentInfo();
      agentInfo.label=resolveInfo.loadLabel(pm);
      agentInfo.icon=resolveInfo.loadIcon(pm);
      agentInfo.component=name;
      agentInfo.settings=getSettingsComponentName(pm,resolveInfo);
      mAvailableAgents.put(name,agentInfo);
    }
  }
  ((BaseAdapter)getListAdapter()).notifyDataSetChanged();
}
