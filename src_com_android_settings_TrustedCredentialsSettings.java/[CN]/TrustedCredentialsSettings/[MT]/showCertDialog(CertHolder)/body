{
  AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
  builder.setTitle(com.android.internal.R.string.ssl_certificate);
  final DevicePolicyManager dpm=getActivity().getSystemService(DevicePolicyManager.class);
  final ArrayList<View> views=new ArrayList<View>();
  final ArrayList<String> titles=new ArrayList<String>();
  addCertChain(certHolder,views,titles);
  ArrayAdapter<String> arrayAdapter=new ArrayAdapter<String>(getActivity(),android.R.layout.simple_spinner_item,titles);
  arrayAdapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
  Spinner spinner=new Spinner(getActivity());
  spinner.setAdapter(arrayAdapter);
  spinner.setOnItemSelectedListener(new OnItemSelectedListener(){
    @Override public void onItemSelected(    AdapterView<?> parent,    View view,    int position,    long id){
      for (int i=0; i < views.size(); i++) {
        views.get(i).setVisibility(i == position ? View.VISIBLE : View.GONE);
      }
    }
    @Override public void onNothingSelected(    AdapterView<?> parent){
    }
  }
);
  LinearLayout container=new LinearLayout(getActivity());
  container.setOrientation(LinearLayout.VERTICAL);
  container.addView(spinner);
  for (int i=0; i < views.size(); ++i) {
    View certificateView=views.get(i);
    if (i != 0) {
      certificateView.setVisibility(View.GONE);
    }
    container.addView(certificateView);
  }
  builder.setView(container);
  if (certHolder.mTab == Tab.USER && !dpm.isCaCertApproved(certHolder.mAlias,certHolder.mProfileId)) {
    builder.setPositiveButton(R.string.trusted_credentials_trust_label,new DialogInterface.OnClickListener(){
      @Override public void onClick(      DialogInterface dialog,      int id){
        dpm.approveCaCert(certHolder.mAlias,certHolder.mProfileId,true);
      }
    }
);
  }
 else {
    builder.setPositiveButton(android.R.string.ok,null);
  }
  if (!mUserManager.hasUserRestriction(UserManager.DISALLOW_CONFIG_CREDENTIALS,new UserHandle(certHolder.mProfileId))) {
    builder.setNegativeButton(certHolder.mTab.getButtonLabel(certHolder),new DialogInterface.OnClickListener(){
      @Override public void onClick(      final DialogInterface parentDialog,      int i){
        AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
        builder.setMessage(certHolder.mTab.getButtonConfirmation(certHolder));
        builder.setPositiveButton(android.R.string.yes,new DialogInterface.OnClickListener(){
          @Override public void onClick(          DialogInterface dialog,          int id){
            new AliasOperation(certHolder).execute();
            dialog.dismiss();
            parentDialog.dismiss();
          }
        }
);
        builder.setNegativeButton(android.R.string.no,null);
        AlertDialog alert=builder.create();
        alert.show();
      }
    }
);
  }
  builder.show();
}
