{
  final int profileId=pe.userHandle.getIdentifier();
  pe.preference.setEnabled(false);
  pe.preference.setTitle(pe.packageName);
  pe.preference.setIcon(mUserManager.getBadgedIconForUser(mPackageManager.getDefaultActivityIcon(),pe.userHandle));
  try {
    final ApplicationInfo info=mIPackageManager.getApplicationInfo(pe.packageName,0,profileId);
    if (info != null) {
      pe.preference.setEnabled(true);
      pe.preference.setTitle(info.loadLabel(mPackageManager).toString());
      pe.preference.setIcon(mUserManager.getBadgedIconForUser(info.loadIcon(mPackageManager),pe.userHandle));
    }
  }
 catch (  RemoteException e) {
    Log.w(TAG,"PackageManager is dead. Can't get app info for package " + pe.packageName + " of user "+ profileId);
  }
  pe.preference.setKey(pe.packageName);
  Bundle extra=pe.preference.getExtras();
  extra.putInt(BUNDLE_KEY_PROFILEID,profileId);
  boolean check=false;
  if (pe.appOpMode == AppOpsManager.MODE_ALLOWED) {
    check=true;
  }
 else   if (pe.appOpMode == AppOpsManager.MODE_DEFAULT) {
    check=pe.permissionGranted;
  }
  if (check != pe.preference.isChecked()) {
    pe.preference.setChecked(check);
  }
}
