{
  final String packageName=preference.getKey();
  final PackageEntry pe=mPackageEntryMap.get(packageName);
  if (pe == null) {
    Log.w(TAG,"Preference change event for package " + packageName + " but that package is no longer valid.");
    return false;
  }
  if (!(newValue instanceof Boolean)) {
    Log.w(TAG,"Preference change event for package " + packageName + " had non boolean value of type "+ newValue.getClass().getName());
    return false;
  }
  final int newMode=(Boolean)newValue ? AppOpsManager.MODE_ALLOWED : AppOpsManager.MODE_IGNORED;
  if (pe.appOpMode != newMode) {
    if (newMode != AppOpsManager.MODE_ALLOWED) {
      setNewMode(pe,newMode);
      return true;
    }
    FragmentTransaction ft=getChildFragmentManager().beginTransaction();
    Fragment prev=getChildFragmentManager().findFragmentByTag("warning");
    if (prev != null) {
      ft.remove(prev);
    }
    WarningDialogFragment.newInstance(pe.packageName).show(ft,"warning");
    return false;
  }
  return true;
}
