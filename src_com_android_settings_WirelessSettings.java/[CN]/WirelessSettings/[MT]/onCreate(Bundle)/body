{
  super.onCreate(savedInstanceState);
  addPreferencesFromResource(R.xml.wireless_settings);
  CheckBoxPreference airplane=(CheckBoxPreference)findPreference(KEY_TOGGLE_AIRPLANE);
  CheckBoxPreference wifi=(CheckBoxPreference)findPreference(KEY_TOGGLE_WIFI);
  CheckBoxPreference bt=(CheckBoxPreference)findPreference(KEY_TOGGLE_BLUETOOTH);
  CheckBoxPreference nfc=(CheckBoxPreference)findPreference(KEY_TOGGLE_NFC);
  mAirplaneModeEnabler=new AirplaneModeEnabler(this,airplane);
  mAirplaneModePreference=(CheckBoxPreference)findPreference(KEY_TOGGLE_AIRPLANE);
  mWifiEnabler=new WifiEnabler(this,wifi);
  mBtEnabler=new BluetoothEnabler(this,bt);
  mNfcEnabler=new NfcEnabler(this,nfc);
  String toggleable=Settings.System.getString(getContentResolver(),Settings.System.AIRPLANE_MODE_TOGGLEABLE_RADIOS);
  boolean isWimaxEnabled=this.getResources().getBoolean(com.android.internal.R.bool.config_wimaxEnabled);
  if (!isWimaxEnabled) {
    PreferenceScreen root=getPreferenceScreen();
    Preference ps=(Preference)findPreference(KEY_WIMAX_SETTINGS);
    if (ps != null)     root.removePreference(ps);
  }
 else {
    if (toggleable == null || !toggleable.contains(Settings.System.RADIO_WIMAX) && isWimaxEnabled) {
      Preference ps=(Preference)findPreference(KEY_WIMAX_SETTINGS);
      ps.setDependency(KEY_TOGGLE_AIRPLANE);
    }
  }
  if (toggleable == null || !toggleable.contains(Settings.System.RADIO_WIFI)) {
    wifi.setDependency(KEY_TOGGLE_AIRPLANE);
    findPreference(KEY_WIFI_SETTINGS).setDependency(KEY_TOGGLE_AIRPLANE);
    findPreference(KEY_VPN_SETTINGS).setDependency(KEY_TOGGLE_AIRPLANE);
  }
  if (toggleable == null || !toggleable.contains(Settings.System.RADIO_BLUETOOTH)) {
    bt.setDependency(KEY_TOGGLE_AIRPLANE);
    findPreference(KEY_BT_SETTINGS).setDependency(KEY_TOGGLE_AIRPLANE);
  }
  if (ServiceManager.getService(BluetoothAdapter.BLUETOOTH_SERVICE) == null) {
    getPreferenceScreen().removePreference(bt);
  }
  if (NfcAdapter.getDefaultAdapter(this) == null) {
    getPreferenceScreen().removePreference(nfc);
  }
  ConnectivityManager cm=(ConnectivityManager)getSystemService(Context.CONNECTIVITY_SERVICE);
  if (!cm.isTetheringSupported()) {
    getPreferenceScreen().removePreference(findPreference(KEY_TETHER_SETTINGS));
  }
 else {
    String[] usbRegexs=cm.getTetherableUsbRegexs();
    String[] wifiRegexs=cm.getTetherableWifiRegexs();
    Preference p=findPreference(KEY_TETHER_SETTINGS);
    if (wifiRegexs.length == 0) {
      p.setTitle(R.string.tether_settings_title_usb);
      p.setSummary(R.string.tether_settings_summary_usb);
    }
 else {
      if (usbRegexs.length == 0) {
        p.setTitle(R.string.tether_settings_title_wifi);
        p.setSummary(R.string.tether_settings_summary_wifi);
      }
 else {
        p.setTitle(R.string.tether_settings_title_both);
        p.setSummary(R.string.tether_settings_summary_both);
      }
    }
  }
}
