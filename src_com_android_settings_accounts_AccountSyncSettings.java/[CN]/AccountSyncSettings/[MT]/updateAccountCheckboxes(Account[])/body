{
  mInvisibleAdapters.clear();
  SyncAdapterType[] syncAdapters=ContentResolver.getSyncAdapterTypes();
  HashMap<String,ArrayList<String>> accountTypeToAuthorities=Maps.newHashMap();
  for (int i=0, n=syncAdapters.length; i < n; i++) {
    final SyncAdapterType sa=syncAdapters[i];
    if (sa.isUserVisible()) {
      ArrayList<String> authorities=accountTypeToAuthorities.get(sa.accountType);
      if (authorities == null) {
        authorities=new ArrayList<String>();
        accountTypeToAuthorities.put(sa.accountType,authorities);
      }
      if (Log.isLoggable(TAG,Log.VERBOSE)) {
        Log.d(TAG,"onAccountUpdated: added authority " + sa.authority + " to accountType "+ sa.accountType);
      }
      authorities.add(sa.authority);
    }
 else {
      mInvisibleAdapters.add(sa);
    }
  }
  for (int i=0, n=mCheckBoxes.size(); i < n; i++) {
    getPreferenceScreen().removePreference(mCheckBoxes.get(i));
  }
  mCheckBoxes.clear();
  for (int i=0, n=accounts.length; i < n; i++) {
    final Account account=accounts[i];
    if (Log.isLoggable(TAG,Log.VERBOSE)) {
      Log.d(TAG,"looking for sync adapters that match account " + account);
    }
    final ArrayList<String> authorities=accountTypeToAuthorities.get(account.type);
    if (authorities != null && (mAccount == null || mAccount.equals(account))) {
      for (int j=0, m=authorities.size(); j < m; j++) {
        final String authority=authorities.get(j);
        int syncState=ContentResolver.getIsSyncable(account,authority);
        if (Log.isLoggable(TAG,Log.VERBOSE)) {
          Log.d(TAG,"  found authority " + authority + " "+ syncState);
        }
        if (syncState > 0) {
          addSyncStateCheckBox(account,authority);
        }
      }
    }
  }
  Collections.sort(mCheckBoxes);
  for (int i=0, n=mCheckBoxes.size(); i < n; i++) {
    getPreferenceScreen().addPreference(mCheckBoxes.get(i));
  }
}
