{
  if (getActivity() == null)   return;
  getPreferenceScreen().removeAll();
  mFirstAccount=null;
  addPreferencesFromResource(R.xml.manage_accounts_settings);
  for (int i=0, n=accounts.length; i < n; i++) {
    final Account account=accounts[i];
    if (mAccountType != null && !account.type.equals(mAccountType))     continue;
    final ArrayList<String> auths=getAuthoritiesForAccountType(account.type);
    boolean showAccount=true;
    if (mAuthorities != null && auths != null) {
      showAccount=false;
      for (      String requestedAuthority : mAuthorities) {
        if (auths.contains(requestedAuthority)) {
          showAccount=true;
          break;
        }
      }
    }
    if (showAccount) {
      final Drawable icon=getDrawableForType(account.type);
      final AccountPreference preference=new AccountPreference(getActivity(),account,icon,auths,false);
      getPreferenceScreen().addPreference(preference);
      if (mFirstAccount == null) {
        mFirstAccount=account;
        getActivity().invalidateOptionsMenu();
      }
    }
  }
  if (mAccountType != null && mFirstAccount != null) {
    addAuthenticatorSettings();
  }
 else {
    Intent settingsTop=new Intent(android.provider.Settings.ACTION_SETTINGS);
    settingsTop.setFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP);
    getActivity().startActivity(settingsTop);
  }
  onSyncStateUpdated();
}
