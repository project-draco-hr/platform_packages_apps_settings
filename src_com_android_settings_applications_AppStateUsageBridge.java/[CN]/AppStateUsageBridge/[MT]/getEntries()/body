{
  try {
    final String[] packages=mIPackageManager.getAppOpPermissionPackages(Manifest.permission.PACKAGE_USAGE_STATS);
    if (packages == null) {
      return null;
    }
    SparseArray<ArrayMap<String,UsageState>> entries=new SparseArray<>();
    for (    final UserHandle profile : mProfiles) {
      final ArrayMap<String,UsageState> entriesForProfile=new ArrayMap<>();
      final int profileId=profile.getIdentifier();
      entries.put(profileId,entriesForProfile);
      for (      final String packageName : packages) {
        final boolean isAvailable=mIPackageManager.isPackageAvailable(packageName,profileId);
        if (!shouldIgnorePackage(packageName) && isAvailable) {
          final UsageState newEntry=new UsageState(packageName,profile);
          entriesForProfile.put(packageName,newEntry);
        }
      }
    }
    return entries;
  }
 catch (  RemoteException e) {
    Log.w(TAG,"PackageManager is dead. Can't get list of packages requesting " + Manifest.permission.PACKAGE_USAGE_STATS,e);
    return null;
  }
}
