{
  try {
    for (    final UserHandle profile : mProfiles) {
      final int profileId=profile.getIdentifier();
      final ArrayMap<String,UsageState> entriesForProfile=entries.get(profileId);
      if (entriesForProfile == null) {
        continue;
      }
      @SuppressWarnings("unchecked") final List<PackageInfo> packageInfos=mIPackageManager.getPackagesHoldingPermissions(PM_USAGE_STATS_PERMISSION,0,profileId).getList();
      final int packageInfoCount=packageInfos != null ? packageInfos.size() : 0;
      for (int i=0; i < packageInfoCount; i++) {
        final PackageInfo packageInfo=packageInfos.get(i);
        final UsageState pe=entriesForProfile.get(packageInfo.packageName);
        if (pe != null) {
          pe.packageInfo=packageInfo;
          pe.permissionGranted=true;
        }
      }
    }
  }
 catch (  RemoteException e) {
    Log.w(TAG,"PackageManager is dead. Can't get list of packages granted " + Manifest.permission.PACKAGE_USAGE_STATS,e);
    return;
  }
}
