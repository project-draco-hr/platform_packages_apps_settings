{
  if (mOwner.getActivity() == null)   return;
  if (mApplications == null)   return;
  mFreeStorage=0;
  mAppStorage=0;
  mTotalStorage=0;
  if (mFilter == FILTER_APPS_SDCARD) {
    if (mContainerService != null) {
      try {
        final long[] stats=mContainerService.getFileSystemStats(Environment.getExternalStorageDirectory().getPath());
        mTotalStorage=stats[0];
        mFreeStorage=stats[1];
      }
 catch (      RemoteException e) {
        Log.w(TAG,"Problem in container service",e);
      }
    }
    if (mApplications != null) {
      final int N=mApplications.getCount();
      for (int i=0; i < N; i++) {
        ApplicationsState.AppEntry ae=mApplications.getAppEntry(i);
        mAppStorage+=ae.externalCodeSize + ae.externalDataSize;
      }
    }
  }
 else {
    if (mContainerService != null) {
      try {
        final long[] stats=mContainerService.getFileSystemStats(Environment.getDataDirectory().getPath());
        mTotalStorage=stats[0];
        mFreeStorage=stats[1];
      }
 catch (      RemoteException e) {
        Log.w(TAG,"Problem in container service",e);
      }
    }
    final boolean emulatedStorage=Environment.isExternalStorageEmulated();
    if (mApplications != null) {
      final int N=mApplications.getCount();
      for (int i=0; i < N; i++) {
        ApplicationsState.AppEntry ae=mApplications.getAppEntry(i);
        mAppStorage+=ae.codeSize + ae.dataSize;
        if (emulatedStorage) {
          mAppStorage+=ae.externalCodeSize + ae.externalDataSize;
        }
      }
    }
    mFreeStorage+=mApplicationsState.sumCacheSizes();
  }
  applyCurrentStorage();
}
