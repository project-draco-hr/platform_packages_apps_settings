{
  super.onCreate(icicle);
  addPreferencesFromResource(R.xml.default_apps);
  mPm=getPackageManager();
  myUserId=UserHandle.myUserId();
  mDefaultBrowserPreference=(DefaultBrowserPreference)findPreference(KEY_DEFAULT_BROWSER);
  mDefaultBrowserPreference.setOnPreferenceClickListener(new Preference.OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      final CharSequence packageName=mDefaultBrowserPreference.getValue();
      if (TextUtils.isEmpty(packageName)) {
        return false;
      }
      return mPm.setDefaultBrowserPackageName(packageName.toString(),myUserId);
    }
  }
);
  final boolean isRestrictedUser=UserManager.get(getActivity()).getUserInfo(myUserId).isRestricted();
  if (isRestrictedUser || !DefaultSmsPreference.isAvailable(getActivity())) {
    removePreference(KEY_SMS_APPLICATION);
  }
  if (!DefaultEmergencyPreference.isAvailable(getActivity())) {
    removePreference(KEY_DEFAULT_EMERGENCY_APP);
  }
  if (DefaultEmergencyPreference.isCapable(getActivity())) {
    Index.getInstance(getActivity()).updateFromClassNameResource(ManageDefaultApps.class.getName(),true,true);
  }
}
