{
  Activity activity=getActivity();
  PreferenceScreen screen=getPreferenceScreen();
  if (screen == null) {
    screen=getPreferenceManager().createPreferenceScreen(activity);
    setPreferenceScreen(screen);
  }
 else {
    screen.removeAll();
    if (mExtraScreen != null) {
      mExtraScreen.removeAll();
    }
  }
  final int count=screen.getPreferenceCount();
  if (count == 0) {
    final Preference extraScreenPreference=new Preference(activity);
    extraScreenPreference.setIcon(R.drawable.ic_toc);
    extraScreenPreference.setTitle(R.string.additional_permissions);
    List<PermissionGroup> groups=mPermissionsInfo.getGroups();
    for (    PermissionGroup group : groups) {
      if (group.possibleApps.size() == 0)       continue;
      PermissionPreference pref=new PermissionPreference(activity,group);
      pref.refreshUi();
      if (group.packageName.equals(OS_PKG)) {
        screen.addPreference(pref);
      }
 else {
        if (mExtraScreen == null) {
          mExtraScreen=getPreferenceManager().createPreferenceScreen(activity);
        }
        mExtraScreen.addPreference(pref);
      }
    }
    if (mExtraScreen != null) {
      extraScreenPreference.setOnPreferenceClickListener(new OnPreferenceClickListener(){
        @Override public boolean onPreferenceClick(        Preference preference){
          AdditionalPermissionsFragment frag=new AdditionalPermissionsFragment();
          frag.setTargetFragment(ManagePermissions.this,0);
          FragmentTransaction ft=getFragmentManager().beginTransaction();
          ft.replace(R.id.main_content,frag);
          ft.addToBackStack("AdditionalPerms");
          ft.commit();
          return true;
        }
      }
);
      extraScreenPreference.setSummary(getString(R.string.additional_permissions_more,mExtraScreen.getPreferenceCount()));
      screen.addPreference(extraScreenPreference);
    }
  }
 else {
    updatePrefs(screen);
    if (mExtraScreen != null) {
      updatePrefs(mExtraScreen);
    }
  }
}
