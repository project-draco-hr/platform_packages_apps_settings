{
  if (device == null) {
    Log.e(TAG,"ACTION_BOND_STATE_CHANGED with no EXTRA_DEVICE");
    return;
  }
  int bondState=intent.getIntExtra(BluetoothDevice.EXTRA_BOND_STATE,BluetoothDevice.ERROR);
  CachedBluetoothDevice cachedDevice=mDeviceManager.findDevice(device);
  if (cachedDevice == null) {
    Log.w(TAG,"CachedBluetoothDevice for device " + device + " not found, calling readPairedDevices().");
    if (!readPairedDevices()) {
      Log.e(TAG,"Got bonding state changed for " + device + ", but we have no record of that device.");
      return;
    }
    cachedDevice=mDeviceManager.findDevice(device);
    if (cachedDevice == null) {
      Log.e(TAG,"Got bonding state changed for " + device + ", but device not added in cache.");
      return;
    }
  }
synchronized (mCallbacks) {
    for (    BluetoothCallback callback : mCallbacks) {
      callback.onDeviceBondStateChanged(cachedDevice,bondState);
    }
  }
  cachedDevice.onBondingStateChanged(bondState);
  if (bondState == BluetoothDevice.BOND_NONE) {
    if (device.isBluetoothDock()) {
      LocalBluetoothPreferences.removeDockAutoConnectSetting(context,device.getAddress());
      if (!device.getAddress().equals(getDockedDeviceAddress(context))) {
        cachedDevice.setVisible(false);
      }
    }
    int reason=intent.getIntExtra(BluetoothDevice.EXTRA_REASON,BluetoothDevice.ERROR);
    showUnbondMessage(context,cachedDevice.getName(),reason);
  }
}
