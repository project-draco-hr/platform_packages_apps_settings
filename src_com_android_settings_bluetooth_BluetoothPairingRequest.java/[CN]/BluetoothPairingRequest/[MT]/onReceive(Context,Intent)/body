{
  String action=intent.getAction();
  if (action.equals(BluetoothIntent.PAIRING_REQUEST_ACTION)) {
    LocalBluetoothManager localManager=LocalBluetoothManager.getInstance(context);
    BluetoothDevice device=intent.getParcelableExtra(BluetoothIntent.DEVICE);
    int type=intent.getIntExtra(BluetoothIntent.PAIRING_VARIANT,BluetoothClass.ERROR);
    Intent pairingIntent=new Intent();
    pairingIntent.setClass(context,BluetoothPairingDialog.class);
    pairingIntent.putExtra(BluetoothIntent.DEVICE,device);
    pairingIntent.putExtra(BluetoothIntent.PAIRING_VARIANT,type);
    if (type == BluetoothDevice.PAIRING_VARIANT_CONFIRMATION) {
      int passkey=intent.getIntExtra(BluetoothIntent.PASSKEY,BluetoothClass.ERROR);
      pairingIntent.putExtra(BluetoothIntent.PASSKEY,passkey);
    }
    pairingIntent.setAction(BluetoothIntent.PAIRING_REQUEST_ACTION);
    pairingIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);
    if (localManager.getForegroundActivity() != null) {
      context.startActivity(pairingIntent);
    }
 else {
      Resources res=context.getResources();
      Notification notification=new Notification(android.R.drawable.stat_sys_data_bluetooth,res.getString(R.string.bluetooth_notif_ticker),System.currentTimeMillis());
      PendingIntent pending=PendingIntent.getActivity(context,0,pairingIntent,PendingIntent.FLAG_ONE_SHOT);
      String name=intent.getStringExtra(BluetoothIntent.NAME);
      if (TextUtils.isEmpty(name)) {
        name=device.getName();
      }
      notification.setLatestEventInfo(context,res.getString(R.string.bluetooth_notif_title),res.getString(R.string.bluetooth_notif_message) + name,pending);
      notification.flags|=Notification.FLAG_AUTO_CANCEL;
      NotificationManager manager=(NotificationManager)context.getSystemService(Context.NOTIFICATION_SERVICE);
      manager.notify(NOTIFICATION_ID,notification);
    }
  }
 else   if (action.equals(BluetoothIntent.PAIRING_CANCEL_ACTION)) {
    NotificationManager manager=(NotificationManager)context.getSystemService(Context.NOTIFICATION_SERVICE);
    manager.cancel(NOTIFICATION_ID);
  }
}
