{
  super.onCreate(savedInstanceState);
  mLocalManager=LocalBluetoothManager.getInstance(this);
  if (mLocalManager == null)   finish();
  mFilterType=BluetoothDevicePicker.FILTER_TYPE_ALL;
  Intent intent=getIntent();
  String action=intent.getAction();
  if (action.equals(BluetoothDevicePicker.ACTION_LAUNCH)) {
    mScreenType=SCREEN_TYPE_DEVICEPICKER;
    mNeedAuth=intent.getBooleanExtra(BluetoothDevicePicker.EXTRA_NEED_AUTH,false);
    mFilterType=intent.getIntExtra(BluetoothDevicePicker.EXTRA_FILTER_TYPE,BluetoothDevicePicker.FILTER_TYPE_ALL);
    mLaunchPackage=intent.getStringExtra(BluetoothDevicePicker.EXTRA_LAUNCH_PACKAGE);
    mLaunchClass=intent.getStringExtra(BluetoothDevicePicker.EXTRA_LAUNCH_CLASS);
    setTitle(getString(R.string.device_picker));
    addPreferencesFromResource(R.xml.device_picker);
  }
 else {
    addPreferencesFromResource(R.xml.bluetooth_settings);
    mEnabler=new BluetoothEnabler(this,(CheckBoxPreference)findPreference(KEY_BT_CHECKBOX));
    mDiscoverableEnabler=new BluetoothDiscoverableEnabler(this,(CheckBoxPreference)findPreference(KEY_BT_DISCOVERABLE));
    mNamePreference=(BluetoothNamePreference)findPreference(KEY_BT_NAME);
    mDeviceList=(ProgressCategory)findPreference(KEY_BT_DEVICE_LIST);
  }
  mDeviceList=(ProgressCategory)findPreference(KEY_BT_DEVICE_LIST);
  registerForContextMenu(getListView());
}
