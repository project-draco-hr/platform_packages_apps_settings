{
  final PreferenceScreen preferenceScreen=getPreferenceScreen();
  int messageId=0;
switch (bluetoothState) {
case BluetoothAdapter.STATE_ON:
    preferenceScreen.removeAll();
  preferenceScreen.setOrderingAsAdded(true);
mDevicePreferenceMap.clear();
if (mPairedDevicesCategory == null) {
mPairedDevicesCategory=new PreferenceCategory(getActivity());
}
 else {
mPairedDevicesCategory.removeAll();
}
addDeviceCategory(mPairedDevicesCategory,R.string.bluetooth_preference_paired_devices,BluetoothDeviceFilter.BONDED_DEVICE_FILTER);
int numberOfPairedDevices=mPairedDevicesCategory.getPreferenceCount();
if (mAvailableDevicesCategory == null) {
mAvailableDevicesCategory=new BluetoothProgressCategory(getActivity());
mAvailableDevicesCategory.setSelectable(false);
}
 else {
mAvailableDevicesCategory.removeAll();
}
if (!isRestrictedAndNotPinProtected()) {
addDeviceCategory(mAvailableDevicesCategory,R.string.bluetooth_preference_found_devices,BluetoothDeviceFilter.UNBONDED_DEVICE_FILTER);
}
int numberOfAvailableDevices=mAvailableDevicesCategory.getPreferenceCount();
mAvailableDevicesCategoryIsPresent=true;
if (numberOfAvailableDevices == 0) {
preferenceScreen.removePreference(mAvailableDevicesCategory);
mAvailableDevicesCategoryIsPresent=false;
}
if (numberOfPairedDevices == 0) {
preferenceScreen.removePreference(mPairedDevicesCategory);
if (scanState == true) {
mActivityStarted=false;
startScanning();
}
 else {
if (!mAvailableDevicesCategoryIsPresent) {
getPreferenceScreen().addPreference(mAvailableDevicesCategory);
}
}
}
if (mMyDevicePreference == null) {
mMyDevicePreference=new Preference(getActivity());
}
mMyDevicePreference.setSummary(getResources().getString(R.string.bluetooth_is_visible_message,mLocalAdapter.getName()));
mMyDevicePreference.setSelectable(false);
mMyDevicePreference.setEnabled(false);
preferenceScreen.addPreference(mMyDevicePreference);
getActivity().invalidateOptionsMenu();
return;
case BluetoothAdapter.STATE_TURNING_OFF:
messageId=R.string.bluetooth_turning_off;
break;
case BluetoothAdapter.STATE_OFF:
messageId=R.string.bluetooth_empty_list_bluetooth_off;
break;
case BluetoothAdapter.STATE_TURNING_ON:
messageId=R.string.bluetooth_turning_on;
break;
}
setDeviceListGroup(preferenceScreen);
removeAllDevices();
mEmptyView.setText(messageId);
getActivity().invalidateOptionsMenu();
}
