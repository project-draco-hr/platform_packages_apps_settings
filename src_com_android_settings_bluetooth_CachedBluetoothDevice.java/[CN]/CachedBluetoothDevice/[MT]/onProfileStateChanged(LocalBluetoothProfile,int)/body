{
  if (Utils.D) {
    Log.d(TAG,"onProfileStateChanged: profile " + profile + " newProfileState "+ newProfileState);
  }
  if (mLocalAdapter.getBluetoothState() == BluetoothAdapter.STATE_TURNING_OFF) {
    if (Utils.D)     Log.d(TAG," BT Turninig Off...Profile conn state change ignored...");
    return;
  }
  mProfileConnectionState.put(profile,newProfileState);
  if (newProfileState == BluetoothProfile.STATE_CONNECTED) {
    if (!mProfiles.contains(profile)) {
      mRemovedProfiles.remove(profile);
      mProfiles.add(profile);
      if (profile instanceof PanProfile && ((PanProfile)profile).isLocalRoleNap(mDevice)) {
        mLocalNapRoleConnected=true;
      }
    }
    if (profile instanceof MapProfile) {
      profile.setPreferred(mDevice,true);
    }
  }
 else   if (profile instanceof MapProfile && newProfileState == BluetoothProfile.STATE_DISCONNECTED) {
    if (mProfiles.contains(profile)) {
      mRemovedProfiles.add(profile);
      mProfiles.remove(profile);
    }
    profile.setPreferred(mDevice,false);
  }
 else   if (mLocalNapRoleConnected && profile instanceof PanProfile && ((PanProfile)profile).isLocalRoleNap(mDevice)&& newProfileState == BluetoothProfile.STATE_DISCONNECTED) {
    Log.d(TAG,"Removing PanProfile from device after NAP disconnect");
    mProfiles.remove(profile);
    mRemovedProfiles.add(profile);
    mLocalNapRoleConnected=false;
  }
}
