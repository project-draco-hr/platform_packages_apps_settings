{
synchronized (workQueue) {
    if (D) {
      Log.d(TAG,"onProfileStateChanged:" + workQueue.toString());
    }
    int newState=LocalBluetoothProfileManager.getProfileManager(mLocalManager,profile).convertState(newProfileState);
    if (newState == SettingsBtStatus.CONNECTION_STATUS_CONNECTED) {
      if (!mProfiles.contains(profile)) {
        mProfiles.add(profile);
      }
    }
    if (newState == SettingsBtStatus.CONNECTION_STATUS_CONNECTED || newState == SettingsBtStatus.CONNECTION_STATUS_DISCONNECTED) {
      BluetoothJob job=workQueue.peek();
      if (job == null) {
        return;
      }
 else       if (!job.cachedDevice.mDevice.equals(mDevice)) {
        if (D) {
          Log.d(TAG,"mDevice:" + mDevice + " != head:"+ job.toString());
        }
        if (!pruneQueue(null)) {
          return;
        }
      }
 else {
        workQueue.poll();
      }
      processCommands();
    }
  }
}
