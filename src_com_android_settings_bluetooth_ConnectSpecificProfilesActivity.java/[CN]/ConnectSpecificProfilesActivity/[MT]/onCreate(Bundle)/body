{
  super.onCreate(savedInstanceState);
  BluetoothDevice device;
  if (savedInstanceState != null) {
    device=savedInstanceState.getParcelable(EXTRA_DEVICE);
  }
 else {
    Intent intent=getIntent();
    device=intent.getParcelableExtra(EXTRA_DEVICE);
  }
  if (device == null) {
    Log.w(TAG,"Activity started without a remote blueototh device");
    finish();
  }
  mManager=LocalBluetoothManager.getInstance(this);
  mCachedDevice=mManager.getCachedDeviceManager().findDevice(device);
  if (mCachedDevice == null) {
    Log.w(TAG,"Device not found, cannot connect to it");
    finish();
  }
  addPreferencesFromResource(R.xml.bluetooth_device_advanced);
  mProfileContainer=(PreferenceGroup)findPreference(KEY_PROFILE_CONTAINER);
  findPreference(KEY_TITLE).setTitle(getString(R.string.bluetooth_device_advanced_title,mCachedDevice.getName()));
  mOnlineModePreference=(CheckBoxPreference)findPreference(KEY_ONLINE_MODE);
  mOnlineModePreference.setOnPreferenceChangeListener(this);
  addPreferencesForProfiles();
}
