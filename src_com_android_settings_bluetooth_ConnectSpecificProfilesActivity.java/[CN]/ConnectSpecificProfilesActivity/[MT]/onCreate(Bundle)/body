{
  super.onCreate(savedInstanceState);
  String address;
  if (savedInstanceState != null) {
    address=savedInstanceState.getString(EXTRA_ADDRESS);
  }
 else {
    Intent intent=getIntent();
    address=intent.getStringExtra(EXTRA_ADDRESS);
  }
  if (TextUtils.isEmpty(address)) {
    Log.w(TAG,"Activity started without address");
    finish();
  }
  mManager=LocalBluetoothManager.getInstance(this);
  mDevice=mManager.getLocalDeviceManager().findDevice(address);
  if (mDevice == null) {
    Log.w(TAG,"Device not found, cannot connect to it");
    finish();
  }
  addPreferencesFromResource(R.xml.bluetooth_device_advanced);
  mProfileContainer=(PreferenceGroup)findPreference(KEY_PROFILE_CONTAINER);
  findPreference(KEY_TITLE).setTitle(getString(R.string.bluetooth_device_advanced_title,mDevice.getName()));
  mOnlineModePreference=(CheckBoxPreference)findPreference(KEY_ONLINE_MODE);
  mOnlineModePreference.setOnPreferenceChangeListener(this);
  addPreferencesForProfiles();
}
