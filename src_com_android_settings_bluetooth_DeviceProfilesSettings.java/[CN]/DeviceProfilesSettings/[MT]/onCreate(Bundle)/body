{
  super.onCreate(savedInstanceState);
  BluetoothDevice device;
  if (savedInstanceState != null) {
    device=savedInstanceState.getParcelable(EXTRA_DEVICE);
  }
 else {
    Bundle args=getArguments();
    device=args.getParcelable(EXTRA_DEVICE);
  }
  if (device == null) {
    Log.w(TAG,"Activity started without a remote Bluetooth device");
    finish();
    return;
  }
  mManager=LocalBluetoothManager.getInstance(getActivity());
  mCachedDevice=mManager.getCachedDeviceManager().findDevice(device);
  if (mCachedDevice == null) {
    Log.w(TAG,"Device not found, cannot connect to it");
    finish();
    return;
  }
  addPreferencesFromResource(R.xml.bluetooth_device_advanced);
  getPreferenceScreen().setOrderingAsAdded(false);
  mProfileContainer=(PreferenceGroup)findPreference(KEY_PROFILE_CONTAINER);
  mAllowIncomingPref=(CheckBoxPreference)findPreference(KEY_ALLOW_INCOMING);
  if (isObjectPushSupported(device)) {
    mAllowIncomingPref.setChecked(isIncomingFileTransfersAllowed());
    mAllowIncomingPref.setOnPreferenceChangeListener(this);
  }
 else {
    getPreferenceScreen().removePreference(mAllowIncomingPref);
    mAllowIncomingPref=null;
  }
  mDeviceNamePref=(EditTextPreference)findPreference(KEY_RENAME_DEVICE);
  mDeviceNamePref.setSummary(mCachedDevice.getName());
  mDeviceNamePref.setText(mCachedDevice.getName());
  mDeviceNamePref.setOnPreferenceChangeListener(this);
  findPreference(KEY_TITLE).setTitle(getResources().getString(R.string.bluetooth_device_advanced_title,mCachedDevice.getName()));
  addPreferencesForProfiles();
}
