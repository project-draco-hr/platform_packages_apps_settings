{
  BluetoothDevice device=mCachedDevice.getDevice();
  if (profilePref.getKey().equals(KEY_PBAP_SERVER)) {
    final int newPermission=mCachedDevice.getPhonebookPermissionChoice() == CachedBluetoothDevice.ACCESS_ALLOWED ? CachedBluetoothDevice.ACCESS_REJECTED : CachedBluetoothDevice.ACCESS_ALLOWED;
    mCachedDevice.setPhonebookPermissionChoice(newPermission);
    profilePref.setChecked(newPermission == CachedBluetoothDevice.ACCESS_ALLOWED);
    return;
  }
  int status=profile.getConnectionStatus(device);
  boolean isConnected=status == BluetoothProfile.STATE_CONNECTED;
  if (profilePref.isChecked()) {
    askDisconnect(mManager.getForegroundActivity(),profile);
  }
 else {
    if (profile instanceof MapProfile) {
      mCachedDevice.setMessagePermissionChoice(BluetoothDevice.ACCESS_ALLOWED);
      refreshProfilePreference(profilePref,profile);
    }
    if (profile.isPreferred(device)) {
      profile.setPreferred(device,false);
      refreshProfilePreference(profilePref,profile);
    }
 else {
      profile.setPreferred(device,true);
      mCachedDevice.connectProfile(profile);
    }
  }
}
