{
  if (mDialog != null) {
    mDialog.dismiss();
    mDialog=null;
  }
  mDevice=device;
switch (state) {
case Intent.EXTRA_DOCK_STATE_CAR:
case Intent.EXTRA_DOCK_STATE_DESK:
case Intent.EXTRA_DOCK_STATE_LE_DESK:
case Intent.EXTRA_DOCK_STATE_HE_DESK:
    break;
default :
  return;
}
startForeground(0,new Notification());
boolean firstTime=!LocalBluetoothPreferences.hasDockAutoConnectSetting(this,device.getAddress());
CharSequence[] items=initBtSettings(device,state,firstTime);
final AlertDialog.Builder ab=new AlertDialog.Builder(this);
ab.setTitle(getString(R.string.bluetooth_dock_settings_title));
ab.setMultiChoiceItems(items,mCheckedItems,mMultiClickListener);
LayoutInflater inflater=(LayoutInflater)getSystemService(LAYOUT_INFLATER_SERVICE);
float pixelScaleFactor=getResources().getDisplayMetrics().density;
View view=inflater.inflate(R.layout.remember_dock_setting,null);
CheckBox rememberCheckbox=(CheckBox)view.findViewById(R.id.remember);
boolean checked=firstTime || LocalBluetoothPreferences.getDockAutoConnectSetting(this,device.getAddress());
rememberCheckbox.setChecked(checked);
rememberCheckbox.setOnCheckedChangeListener(mCheckedChangeListener);
int viewSpacingLeft=(int)(14 * pixelScaleFactor);
int viewSpacingRight=(int)(14 * pixelScaleFactor);
ab.setView(view,viewSpacingLeft,0,viewSpacingRight,0);
if (DEBUG) {
Log.d(TAG,"Auto connect = " + LocalBluetoothPreferences.getDockAutoConnectSetting(this,device.getAddress()));
}
ab.setPositiveButton(getString(android.R.string.ok),mClickListener);
mStartIdAssociatedWithDialog=startId;
mDialog=ab.create();
mDialog.getWindow().setType(WindowManager.LayoutParams.TYPE_KEYGUARD_DIALOG);
mDialog.setOnDismissListener(mDismissListener);
mDialog.show();
}
