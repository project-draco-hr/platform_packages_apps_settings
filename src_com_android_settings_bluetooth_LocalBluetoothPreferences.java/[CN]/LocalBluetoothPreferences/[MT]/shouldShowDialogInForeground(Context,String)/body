{
  LocalBluetoothManager manager=LocalBluetoothManager.getInstance(context);
  if (manager == null) {
    return false;
  }
  if (manager.isForegroundActivity()) {
    return true;
  }
  long currentTimeMillis=System.currentTimeMillis();
  SharedPreferences sharedPreferences=getSharedPreferences(context);
  long lastDiscoverableEndTime=sharedPreferences.getLong(KEY_DISCOVERABLE_END_TIMESTAMP,0);
  if ((lastDiscoverableEndTime + GRACE_PERIOD_TO_SHOW_DIALOGS_IN_FOREGROUND) > currentTimeMillis) {
    return true;
  }
  LocalBluetoothAdapter adapter=manager.getBluetoothAdapter();
  if (adapter != null && adapter.isDiscovering()) {
    return true;
  }
 else   if ((sharedPreferences.getLong(KEY_DISCOVERING_TIMESTAMP,0) + GRACE_PERIOD_TO_SHOW_DIALOGS_IN_FOREGROUND) > currentTimeMillis) {
    return true;
  }
  if (deviceAddress != null) {
    String lastSelectedDevice=sharedPreferences.getString(KEY_LAST_SELECTED_DEVICE,null);
    if (deviceAddress.equals(lastSelectedDevice)) {
      long lastDeviceSelectedTime=sharedPreferences.getLong(KEY_LAST_SELECTED_DEVICE_TIME,0);
      if ((lastDeviceSelectedTime + GRACE_PERIOD_TO_SHOW_DIALOGS_IN_FOREGROUND) > currentTimeMillis) {
        return true;
      }
    }
  }
  return false;
}
