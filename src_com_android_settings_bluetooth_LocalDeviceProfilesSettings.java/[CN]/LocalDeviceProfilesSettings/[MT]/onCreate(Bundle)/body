{
  super.onCreate(savedInstanceState);
  addPreferencesFromResource(R.xml.bluetooth_local_device_profile);
  getPreferenceScreen().setOrderingAsAdded(true);
  mDeviceNamePref=findPreference(KEY_RENAME_DEVICE);
  mDeviceNamePref.setOnPreferenceClickListener(new OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      new BluetoothNameDialogFragment().show(getFragmentManager(),"rename device");
      return true;
    }
  }
);
  mVisibilityPref=findPreference(KEY_VISIBILITY_TIMEOUT);
  mVisibilityPref.setOnPreferenceClickListener(new OnPreferenceClickListener(){
    @Override public boolean onPreferenceClick(    Preference preference){
      new BluetoothVisibilityTimeoutFragment().show(getFragmentManager(),"visibility timeout");
      return true;
    }
  }
);
  mManager=LocalBluetoothManager.getInstance(getActivity());
  mDiscoverableEnabler=mManager.getDiscoverableEnabler();
  mDiscoverableEnabler.setVisibilityPreference(mVisibilityPref);
  PreferenceScreen bluetoothBroadcast=(PreferenceScreen)findPreference(KEY_BROADCASTING);
  mAdvertisingEnabler=new BluetoothAdvertisingEnabler(getActivity(),bluetoothBroadcast);
  mManager.setBluetoothAdvertisingEnabler(mAdvertisingEnabler);
}
