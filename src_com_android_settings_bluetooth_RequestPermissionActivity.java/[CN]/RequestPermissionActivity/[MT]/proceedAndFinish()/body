{
  int returnCode;
  if (mEnableOnly) {
    returnCode=RESULT_OK;
  }
 else   if (mLocalAdapter.setScanMode(BluetoothAdapter.SCAN_MODE_CONNECTABLE_DISCOVERABLE,mTimeout)) {
    LocalBluetoothPreferences.persistDiscoverableEndTimestamp(this,System.currentTimeMillis() + (long)mTimeout * 1000);
    returnCode=mTimeout;
    if (returnCode < RESULT_FIRST_USER) {
      returnCode=RESULT_FIRST_USER;
    }
  }
 else {
    returnCode=RESULT_CANCELED;
  }
  if (mDialog != null) {
    mDialog.dismiss();
  }
  setResult(returnCode);
  finish();
}
