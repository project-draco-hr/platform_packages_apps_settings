{
  int returnCode;
  if (mEnableOnly) {
    returnCode=Activity.RESULT_OK;
  }
 else   if (mLocalManager.getBluetoothAdapter().setScanMode(BluetoothAdapter.SCAN_MODE_CONNECTABLE_DISCOVERABLE,mTimeout)) {
    persistDiscoverableEndTimestamp(System.currentTimeMillis() + mTimeout * 1000);
    returnCode=mTimeout;
    if (returnCode < Activity.RESULT_FIRST_USER) {
      returnCode=Activity.RESULT_FIRST_USER;
    }
  }
 else {
    returnCode=Activity.RESULT_CANCELED;
  }
  setResult(returnCode);
  if (!buttonPressed) {
    finish();
  }
}
