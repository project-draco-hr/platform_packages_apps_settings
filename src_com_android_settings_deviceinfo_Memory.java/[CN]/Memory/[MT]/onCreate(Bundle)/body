{
  super.onCreate(icicle);
  if (mStorageManager == null) {
    mStorageManager=(StorageManager)getSystemService(Context.STORAGE_SERVICE);
    mStorageManager.registerListener(mStorageListener);
  }
  addPreferencesFromResource(R.xml.device_info_memory);
  mResources=getResources();
  if (!Environment.isExternalStorageEmulated()) {
    mInternalStorageVolumePreferenceCategory=new StorageVolumePreferenceCategory(getActivity(),mResources,null,mStorageManager,false);
    getPreferenceScreen().addPreference(mInternalStorageVolumePreferenceCategory);
    mInternalStorageVolumePreferenceCategory.init();
  }
  StorageVolume[] storageVolumes=mStorageManager.getVolumeList();
  boolean massStorageEnabled=(storageVolumes.length > 0 && storageVolumes[0].allowMassStorage());
  int length=storageVolumes.length;
  mStorageVolumePreferenceCategories=new StorageVolumePreferenceCategory[length];
  for (int i=0; i < length; i++) {
    StorageVolume storageVolume=storageVolumes[i];
    boolean isPrimary=i == 0;
    mStorageVolumePreferenceCategories[i]=new StorageVolumePreferenceCategory(getActivity(),mResources,storageVolume,mStorageManager,isPrimary);
    getPreferenceScreen().addPreference(mStorageVolumePreferenceCategories[i]);
    mStorageVolumePreferenceCategories[i].init();
  }
  setHasOptionsMenu(!massStorageEnabled);
}
