{
  super.onCreate(icicle);
  if (mStorageManager == null) {
    mStorageManager=(StorageManager)getSystemService(Context.STORAGE_SERVICE);
    mStorageManager.registerListener(mStorageListener);
  }
  addPreferencesFromResource(R.xml.device_info_memory);
  mRes=getResources();
  mSdSize=findPreference(MEMORY_SD_SIZE);
  mSdAvail=findPreference(MEMORY_SD_AVAIL);
  mSdMountToggle=findPreference(MEMORY_SD_MOUNT_TOGGLE);
  mSdFormat=findPreference(MEMORY_SD_FORMAT);
  mSdMountPreferenceGroup=(PreferenceGroup)findPreference(MEMORY_SD_GROUP);
  if (Environment.isExternalStorageEmulated()) {
    getPreferenceScreen().removePreference(mSdMountPreferenceGroup);
  }
  mInternalSize=findPreference(MEMORY_INTERNAL_SIZE);
  mInternalAppsColor=mRes.getColor(R.color.memory_apps_usage);
  mInternalUsedColor=android.graphics.Color.GRAY;
  mInternalAvailColor=mRes.getColor(R.color.memory_avail);
  final int buttonWidth=(int)mRes.getDimension(R.dimen.device_memory_usage_button_width);
  final int buttonHeight=(int)mRes.getDimension(R.dimen.device_memory_usage_button_height);
  mInternalAvail=findPreference(MEMORY_INTERNAL_AVAIL);
  mInternalAvail.setIcon(createRectShape(buttonHeight,buttonWidth,mInternalAvailColor));
  mInternalAppsUsage=findPreference(MEMORY_INTERNAL_APPS);
  mInternalAppsUsage.setIcon(createRectShape(buttonHeight,buttonWidth,mInternalAppsColor));
  for (int i=0; i < Constants.NUM_MEDIA_DIRS_TRACKED; i++) {
    if (Constants.mMediaDirs.get(i).mPreferenceName == null) {
      continue;
    }
    mMediaPreferences[i]=findPreference(Constants.mMediaDirs.get(i).mPreferenceName);
    int color=0;
switch (i) {
case Constants.DOWNLOADS_INDEX:
      color=mRes.getColor(R.color.memory_downloads);
    break;
case Constants.PIC_VIDEO_INDEX:
  color=mRes.getColor(R.color.memory_video);
break;
case Constants.MUSIC_INDEX:
color=mRes.getColor(R.color.memory_audio);
break;
case Constants.MEDIA_MISC_INDEX:
color=mRes.getColor(R.color.memory_misc);
break;
}
mMediaPreferences[i].setIcon(createRectShape(buttonHeight,buttonWidth,color));
}
mInternalUsageChart=(UsageBarPreference)findPreference(MEMORY_INTERNAL_CHART);
mMeasurement=MemoryMeasurement.getInstance(getActivity());
mMeasurement.setReceiver(this);
}
