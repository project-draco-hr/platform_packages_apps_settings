{
  super.onCreate(icicle);
  if (mStorageManager == null) {
    mStorageManager=(StorageManager)getSystemService(Context.STORAGE_SERVICE);
    mStorageManager.registerListener(mStorageListener);
  }
  addPreferencesFromResource(R.xml.device_info_memory);
  mResources=getResources();
  if (!Environment.isExternalStorageEmulated()) {
    StorageVolumePreferenceCategory storagePreferenceCategory=new StorageVolumePreferenceCategory(getActivity(),mResources,null,mStorageManager,true);
    mInternalStorageVolumePreferenceCategory=storagePreferenceCategory;
    getPreferenceScreen().addPreference(storagePreferenceCategory);
    storagePreferenceCategory.init();
  }
  StorageVolume[] storageVolumes=mStorageManager.getVolumeList();
  boolean massStorageEnabled=(storageVolumes.length > 0 && storageVolumes[0].allowMassStorage());
  int length=storageVolumes.length;
  mStorageVolumePreferenceCategories=new StorageVolumePreferenceCategory[length];
  for (int i=0; i < length; i++) {
    StorageVolume storageVolume=storageVolumes[i];
    StorageVolumePreferenceCategory storagePreferenceCategory=new StorageVolumePreferenceCategory(getActivity(),mResources,storageVolume,mStorageManager,i == 0);
    mStorageVolumePreferenceCategories[i]=storagePreferenceCategory;
    getPreferenceScreen().addPreference(storagePreferenceCategory);
    storagePreferenceCategory.init();
  }
  setHasOptionsMenu(!massStorageEnabled);
}
