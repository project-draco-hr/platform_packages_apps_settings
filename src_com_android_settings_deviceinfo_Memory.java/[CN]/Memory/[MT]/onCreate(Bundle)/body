{
  super.onCreate(icicle);
  if (mStorageManager == null) {
    mStorageManager=(StorageManager)getSystemService(Context.STORAGE_SERVICE);
    mStorageManager.registerListener(mStorageListener);
  }
  addPreferencesFromResource(R.xml.device_info_memory);
  mRes=getResources();
  mSdSize=findPreference(MEMORY_SD_SIZE);
  mSdAvail=findPreference(MEMORY_SD_AVAIL);
  mSdMountToggle=findPreference(MEMORY_SD_MOUNT_TOGGLE);
  mSdFormat=findPreference(MEMORY_SD_FORMAT);
  mSdMountPreferenceGroup=(PreferenceGroup)findPreference(MEMORY_SD_GROUP);
  if (Environment.isExternalStorageEmulated()) {
    mSdMountPreferenceGroup.removePreference(mSdSize);
    mSdMountPreferenceGroup.removePreference(mSdAvail);
    mSdMountPreferenceGroup.removePreference(mSdMountToggle);
  }
  mPtpModeToggle=(CheckBoxPreference)findPreference(PTP_MODE_TOGGLE);
  if (Usb.isFunctionSupported(Usb.USB_FUNCTION_MTP)) {
    mPtpModeToggle.setChecked(Settings.System.getInt(getContentResolver(),Settings.System.USE_PTP_INTERFACE,0) != 0);
  }
 else {
    getPreferenceScreen().removePreference(mPtpModeToggle);
  }
  mInternalSize=findPreference(MEMORY_INTERNAL_SIZE);
  mInternalAvail=findPreference(MEMORY_INTERNAL_AVAIL);
  mInternalMediaUsage=findPreference(MEMORY_INTERNAL_MEDIA);
  mInternalAppsUsage=findPreference(MEMORY_INTERNAL_APPS);
  mInternalMediaColor=mRes.getColor(R.color.memory_media_usage);
  mInternalAppsColor=mRes.getColor(R.color.memory_apps_usage);
  mInternalUsedColor=mRes.getColor(R.color.memory_used);
  mInternalUsageChart=(UsageBarPreference)findPreference(MEMORY_INTERNAL_CHART);
  final HandlerThread t=new HandlerThread("MeasurementHandler");
  t.start();
  mMeasurementHandler=new MemoryMeasurementHandler(t.getLooper());
}
