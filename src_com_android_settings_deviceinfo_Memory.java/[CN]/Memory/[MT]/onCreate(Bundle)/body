{
  super.onCreate(icicle);
  if (mStorageManager == null) {
    mStorageManager=(StorageManager)getSystemService(Context.STORAGE_SERVICE);
    mStorageManager.registerListener(mStorageListener);
  }
  addPreferencesFromResource(R.xml.device_info_memory);
  mRes=getResources();
  mSdSize=findPreference(MEMORY_SD_SIZE);
  mSdAvail=findPreference(MEMORY_SD_AVAIL);
  mSdMountToggle=findPreference(MEMORY_SD_MOUNT_TOGGLE);
  mSdFormat=findPreference(MEMORY_SD_FORMAT);
  mSdMountPreferenceGroup=(PreferenceGroup)findPreference(MEMORY_SD_GROUP);
  if (Environment.isExternalStorageEmulated()) {
    getPreferenceScreen().removePreference(mSdMountPreferenceGroup);
  }
  mInternalSize=findPreference(MEMORY_INTERNAL_SIZE);
  mInternalAppsColor=mRes.getColor(R.color.memory_apps_usage);
  mInternalUsedColor=android.graphics.Color.GRAY;
  mInternalAvailColor=mRes.getColor(R.color.memory_avail);
  final int buttonSize=(int)mRes.getDimension(R.dimen.device_memory_usage_button_size);
  float[] radius=new float[]{5f,5f,5f,5f,5f,5f,5f,5f};
  RoundRectShape shape1=new RoundRectShape(radius,null,null);
  mInternalAvail=findPreference(MEMORY_INTERNAL_AVAIL);
  ShapeDrawable availShape=new ShapeDrawable(shape1);
  availShape.setIntrinsicWidth(buttonSize);
  availShape.setIntrinsicHeight(buttonSize);
  availShape.getPaint().setColor(mInternalAvailColor);
  mInternalAvail.setIcon(availShape);
  mInternalAppsUsage=findPreference(MEMORY_INTERNAL_APPS);
  ShapeDrawable appsShape=new ShapeDrawable(shape1);
  appsShape.setIntrinsicWidth(buttonSize);
  appsShape.setIntrinsicHeight(buttonSize);
  appsShape.getPaint().setColor(mInternalAppsColor);
  mInternalAppsUsage.setIcon(appsShape);
  for (int i=0; i < Constants.NUM_MEDIA_DIRS_TRACKED; i++) {
    if (Constants.mMediaDirs.get(i).mPreferenceName == null) {
      continue;
    }
    mMediaPreferences[i]=findPreference(Constants.mMediaDirs.get(i).mPreferenceName);
    ShapeDrawable shape=new ShapeDrawable(shape1);
    shape.setIntrinsicWidth(buttonSize);
    shape.setIntrinsicHeight(buttonSize);
    int color=0;
switch (i) {
case Constants.DOWNLOADS_INDEX:
      color=mRes.getColor(R.color.memory_downloads);
    break;
case Constants.PIC_VIDEO_INDEX:
  color=mRes.getColor(R.color.memory_video);
break;
case Constants.MUSIC_INDEX:
color=mRes.getColor(R.color.memory_audio);
break;
case Constants.MEDIA_MISC_INDEX:
color=mRes.getColor(R.color.memory_misc);
break;
}
shape.getPaint().setColor(color);
mMediaPreferences[i].setIcon(shape);
}
mInternalUsageChart=(UsageBarPreference)findPreference(MEMORY_INTERNAL_CHART);
mMeasurement=MemoryMeasurement.getInstance(getActivity());
mMeasurement.setReceiver(this);
}
