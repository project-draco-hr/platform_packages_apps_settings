{
  super(context);
  mStorageManager=context.getSystemService(StorageManager.class);
  mVolume=volume;
  setKey(volume.getId());
  setTitle(mStorageManager.getBestVolumeDescription(volume));
  if (volume.isMountedReadable()) {
    final File path=volume.getPath();
    final long usedBytes=path.getTotalSpace() - path.getFreeSpace();
    final String used=Formatter.formatFileSize(context,usedBytes);
    final String total=Formatter.formatFileSize(context,path.getTotalSpace());
    setSummary(context.getString(R.string.storage_volume_summary,used,total));
  }
 else {
    setSummary(volume.getStateDescription());
  }
  if (VolumeInfo.ID_PRIVATE_INTERNAL.equals(volume.getId())) {
    setIcon(context.getDrawable(R.drawable.ic_settings_storage));
  }
 else {
    setIcon(context.getDrawable(R.drawable.ic_sim_sd));
  }
  if (volume.getType() == VolumeInfo.TYPE_PUBLIC && volume.isMountedReadable()) {
    setWidgetLayoutResource(R.layout.preference_storage_action);
  }
}
