{
  mMountTogglePreference.setEnabled(true);
  String state=mStorageVolume != null ? mStorageManager.getVolumeState(mStorageVolume.getPath()) : Environment.MEDIA_MOUNTED;
  String readOnly="";
  if (Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
    state=Environment.MEDIA_MOUNTED;
    readOnly=mResources.getString(R.string.read_only);
    if (mFormatPreference != null) {
      removePreference(mFormatPreference);
    }
  }
  if ((mStorageVolume == null || !mStorageVolume.isRemovable()) && !Environment.MEDIA_UNMOUNTED.equals(state)) {
    removePreference(mMountTogglePreference);
  }
  if (Environment.MEDIA_MOUNTED.equals(state)) {
    final Preference pref=findPreference(KEY_AVAILABLE);
    pref.setSummary(pref.getSummary() + readOnly);
    mMountTogglePreference.setEnabled(true);
    mMountTogglePreference.setTitle(mResources.getString(R.string.sd_eject));
    mMountTogglePreference.setSummary(mResources.getString(R.string.sd_eject_summary));
  }
 else {
    if (Environment.MEDIA_UNMOUNTED.equals(state) || Environment.MEDIA_NOFS.equals(state) || Environment.MEDIA_UNMOUNTABLE.equals(state)) {
      mMountTogglePreference.setEnabled(true);
      mMountTogglePreference.setTitle(mResources.getString(R.string.sd_mount));
      mMountTogglePreference.setSummary(mResources.getString(R.string.sd_mount_summary));
    }
 else {
      mMountTogglePreference.setEnabled(false);
      mMountTogglePreference.setTitle(mResources.getString(R.string.sd_mount));
      mMountTogglePreference.setSummary(mResources.getString(R.string.sd_insert_summary));
    }
    removePreference(mUsageBarPreference);
    removePreference(findPreference(KEY_TOTAL_SIZE));
    removePreference(findPreference(KEY_AVAILABLE));
    if (mFormatPreference != null) {
      removePreference(mFormatPreference);
    }
  }
  if (mUsbConnected && (UsbManager.USB_FUNCTION_MTP.equals(mUsbFunction) || UsbManager.USB_FUNCTION_PTP.equals(mUsbFunction))) {
    mMountTogglePreference.setEnabled(false);
    if (Environment.MEDIA_MOUNTED.equals(state)) {
      mMountTogglePreference.setSummary(mResources.getString(R.string.mtp_ptp_mode_summary));
    }
    if (mFormatPreference != null) {
      mFormatPreference.setEnabled(false);
      mFormatPreference.setSummary(mResources.getString(R.string.mtp_ptp_mode_summary));
    }
  }
 else   if (mFormatPreference != null) {
    mFormatPreference.setEnabled(true);
    mFormatPreference.setSummary(mResources.getString(R.string.sd_format_summary));
  }
}
