{
  if (mVolume == null)   return;
  mMountTogglePreference.setEnabled(true);
  final String state=mStorageManager.getVolumeState(mVolume.getPath());
  if (Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
    mItemAvailable.setTitle(R.string.memory_available_read_only);
  }
 else {
    mItemAvailable.setTitle(R.string.memory_available);
  }
  if (Environment.MEDIA_MOUNTED.equals(state) || Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
    mMountTogglePreference.setEnabled(true);
    mMountTogglePreference.setTitle(mResources.getString(R.string.sd_eject));
    mMountTogglePreference.setSummary(mResources.getString(R.string.sd_eject_summary));
    addPreference(mUsageBarPreference);
    addPreference(mItemTotal);
    addPreference(mItemAvailable);
  }
 else {
    if (Environment.MEDIA_UNMOUNTED.equals(state) || Environment.MEDIA_NOFS.equals(state) || Environment.MEDIA_UNMOUNTABLE.equals(state)) {
      mMountTogglePreference.setEnabled(true);
      mMountTogglePreference.setTitle(mResources.getString(R.string.sd_mount));
      mMountTogglePreference.setSummary(mResources.getString(R.string.sd_mount_summary));
    }
 else {
      mMountTogglePreference.setEnabled(false);
      mMountTogglePreference.setTitle(mResources.getString(R.string.sd_mount));
      mMountTogglePreference.setSummary(mResources.getString(R.string.sd_insert_summary));
    }
    removePreference(mUsageBarPreference);
    removePreference(mItemTotal);
    removePreference(mItemAvailable);
  }
  if (mUsbConnected && (UsbManager.USB_FUNCTION_MTP.equals(mUsbFunction) || UsbManager.USB_FUNCTION_PTP.equals(mUsbFunction))) {
    mMountTogglePreference.setEnabled(false);
    if (Environment.MEDIA_MOUNTED.equals(state) || Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
      mMountTogglePreference.setSummary(mResources.getString(R.string.mtp_ptp_mode_summary));
    }
    if (mFormatPreference != null) {
      mFormatPreference.setEnabled(false);
      mFormatPreference.setSummary(mResources.getString(R.string.mtp_ptp_mode_summary));
    }
  }
 else   if (mFormatPreference != null) {
    mFormatPreference.setEnabled(mMountTogglePreference.isEnabled());
    mFormatPreference.setSummary(mResources.getString(R.string.sd_format_summary));
  }
}
