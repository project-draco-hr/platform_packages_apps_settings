{
  resetPreferences();
  String state=mStorageVolume != null ? mStorageManager.getVolumeState(mStorageVolume.getPath()) : Environment.MEDIA_MOUNTED;
  String readOnly="";
  if (Environment.MEDIA_MOUNTED_READ_ONLY.equals(state)) {
    state=Environment.MEDIA_MOUNTED;
    readOnly=mResources.getString(R.string.read_only);
    if (mFormatPreference != null) {
      removePreference(mFormatPreference);
    }
  }
  if (mFormatPreference != null) {
    removePreference(mFormatPreference);
  }
  if ((mStorageVolume == null || !mStorageVolume.isRemovable()) && !Environment.MEDIA_UNMOUNTED.equals(state)) {
    removePreference(mMountTogglePreference);
  }
  if (Environment.MEDIA_MOUNTED.equals(state)) {
    mPreferences[AVAILABLE].setSummary(mPreferences[AVAILABLE].getSummary() + readOnly);
    mMountTogglePreference.setEnabled(true);
    mMountTogglePreference.setTitle(mResources.getString(R.string.sd_eject));
    mMountTogglePreference.setSummary(mResources.getString(R.string.sd_eject_summary));
  }
 else {
    if (Environment.MEDIA_UNMOUNTED.equals(state) || Environment.MEDIA_NOFS.equals(state) || Environment.MEDIA_UNMOUNTABLE.equals(state)) {
      mMountTogglePreference.setEnabled(true);
      mMountTogglePreference.setTitle(mResources.getString(R.string.sd_mount));
      mMountTogglePreference.setSummary(mResources.getString(R.string.sd_mount_summary));
    }
 else {
      mMountTogglePreference.setEnabled(false);
      mMountTogglePreference.setTitle(mResources.getString(R.string.sd_mount));
      mMountTogglePreference.setSummary(mResources.getString(R.string.sd_insert_summary));
    }
    removePreference(mUsageBarPreference);
    removePreference(mPreferences[TOTAL_SIZE]);
    removePreference(mPreferences[AVAILABLE]);
    if (mFormatPreference != null) {
      removePreference(mFormatPreference);
    }
  }
}
