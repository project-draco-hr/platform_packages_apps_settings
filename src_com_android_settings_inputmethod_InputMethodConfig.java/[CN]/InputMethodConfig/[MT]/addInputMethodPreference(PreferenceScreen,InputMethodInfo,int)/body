{
  PreferenceCategory keyboardSettingsCategory=new PreferenceCategory(getActivity());
  root.addPreference(keyboardSettingsCategory);
  final String imiId=imi.getId();
  mInputMethodPrefsMap.put(imiId,new ArrayList<Preference>());
  PackageManager pm=getPackageManager();
  CharSequence label=imi.loadLabel(pm);
  keyboardSettingsCategory.setTitle(label);
  final boolean isSystemIME=InputMethodAndSubtypeUtil.isSystemIme(imi);
  CheckBoxPreference chkbxPref=new CheckBoxPreference(getActivity());
  chkbxPref.setKey(imiId);
  chkbxPref.setTitle(label);
  keyboardSettingsCategory.addPreference(chkbxPref);
  if (imiSize <= 1 || isSystemIME) {
    chkbxPref.setEnabled(false);
  }
  Intent intent;
  PreferenceScreen prefScreen=new PreferenceScreen(getActivity(),null);
  prefScreen.setTitle(R.string.active_input_method_subtypes);
  if (imi.getSubtypeCount() > 1) {
    prefScreen.setOnPreferenceClickListener(new OnPreferenceClickListener(){
      @Override public boolean onPreferenceClick(      Preference preference){
        final Bundle bundle=new Bundle();
        bundle.putString(Settings.EXTRA_INPUT_METHOD_ID,imiId);
        startFragment(InputMethodConfig.this,InputMethodAndSubtypeEnabler.class.getName(),0,bundle);
        return true;
      }
    }
);
    keyboardSettingsCategory.addPreference(prefScreen);
    mActiveInputMethodsPrefMap.put(imi,prefScreen);
    mInputMethodPrefsMap.get(imiId).add(prefScreen);
  }
  String settingsActivity=imi.getSettingsActivity();
  if (!TextUtils.isEmpty(settingsActivity)) {
    prefScreen=new PreferenceScreen(getActivity(),null);
    prefScreen.setTitle(R.string.input_method_settings);
    intent=new Intent(Intent.ACTION_MAIN);
    intent.setClassName(imi.getPackageName(),settingsActivity);
    prefScreen.setIntent(intent);
    keyboardSettingsCategory.addPreference(prefScreen);
    mInputMethodPrefsMap.get(imiId).add(prefScreen);
  }
}
