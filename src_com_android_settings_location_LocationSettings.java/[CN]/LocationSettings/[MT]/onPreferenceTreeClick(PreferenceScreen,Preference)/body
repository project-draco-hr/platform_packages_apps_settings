{
  final ContentResolver cr=getContentResolver();
  final UserManager um=(UserManager)getActivity().getSystemService(Context.USER_SERVICE);
  if (preference == mNetwork) {
    if (!um.hasUserRestriction(UserManager.DISALLOW_SHARE_LOCATION)) {
      Settings.Secure.setLocationProviderEnabled(cr,LocationManager.NETWORK_PROVIDER,mNetwork.isChecked());
    }
  }
 else   if (preference == mGps) {
    boolean enabled=mGps.isChecked();
    if (!um.hasUserRestriction(UserManager.DISALLOW_SHARE_LOCATION)) {
      Settings.Secure.setLocationProviderEnabled(cr,LocationManager.GPS_PROVIDER,enabled);
      if (mAssistedGps != null) {
        mAssistedGps.setEnabled(enabled);
      }
    }
  }
 else   if (preference == mAssistedGps) {
    Settings.Global.putInt(cr,Settings.Global.ASSISTED_GPS_ENABLED,mAssistedGps.isChecked() ? 1 : 0);
  }
 else {
    return super.onPreferenceTreeClick(preferenceScreen,preference);
  }
  return true;
}
