{
  HashMap<String,Boolean> packageMap=new HashMap<String,Boolean>();
  AppOpsManager aoManager=(AppOpsManager)mActivity.getSystemService(Context.APP_OPS_SERVICE);
  List<AppOpsManager.PackageOps> appOps=aoManager.getPackagesForOps(new int[]{AppOpsManager.OP_MONITOR_LOCATION,AppOpsManager.OP_MONITOR_HIGH_POWER_LOCATION});
  PreferenceManager preferenceManager=container.getPreferenceManager();
  long now=System.currentTimeMillis();
  for (  AppOpsManager.PackageOps ops : appOps) {
    processPackageOps(now,container,preferenceManager,ops,packageMap);
  }
  mStatsHelper.refreshStats();
  List<BatterySipper> usageList=mStatsHelper.getUsageList();
  for (  BatterySipper sipper : usageList) {
    sipper.loadNameAndIcon();
    String[] packages=sipper.getPackages();
    if (packages == null) {
      continue;
    }
    for (    String curPackage : packages) {
      if (packageMap.containsKey(curPackage)) {
        PreferenceScreen screen=preferenceManager.createPreferenceScreen(mActivity);
        screen.setIcon(sipper.getIcon());
        screen.setTitle(sipper.getLabel());
        if (packageMap.get(curPackage)) {
          screen.setSummary(R.string.location_high_battery_use);
        }
 else {
          screen.setSummary(R.string.location_low_battery_use);
        }
        container.addPreference(screen);
        screen.setOnPreferenceClickListener(new UidEntryClickedListener(sipper));
        packageMap.remove(curPackage);
        break;
      }
    }
  }
  for (  Map.Entry<String,Boolean> entry : packageMap.entrySet()) {
    try {
      PreferenceScreen screen=preferenceManager.createPreferenceScreen(mActivity);
      ApplicationInfo appInfo=mPackageManager.getApplicationInfo(entry.getKey(),PackageManager.GET_META_DATA);
      screen.setIcon(mPackageManager.getApplicationIcon(appInfo));
      screen.setTitle(mPackageManager.getApplicationLabel(appInfo));
      if (entry.getValue()) {
        screen.setSummary(R.string.location_high_battery_use);
      }
 else {
        screen.setSummary(R.string.location_low_battery_use);
      }
      screen.setOnPreferenceClickListener(new PackageEntryClickedListener(entry.getKey()));
      container.addPreference(screen);
    }
 catch (    PackageManager.NameNotFoundException e) {
    }
  }
}
