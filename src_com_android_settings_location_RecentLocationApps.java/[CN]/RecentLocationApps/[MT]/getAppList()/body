{
  AppOpsManager aoManager=(AppOpsManager)mActivity.getSystemService(Context.APP_OPS_SERVICE);
  List<AppOpsManager.PackageOps> appOps=aoManager.getPackagesForOps(new int[]{AppOpsManager.OP_MONITOR_LOCATION,AppOpsManager.OP_MONITOR_HIGH_POWER_LOCATION});
  ArrayList<Preference> prefs=new ArrayList<Preference>();
  long now=System.currentTimeMillis();
  for (  AppOpsManager.PackageOps ops : appOps) {
    int uid=ops.getUid();
    boolean isAndroidOs=(uid == Process.SYSTEM_UID) && ANDROID_SYSTEM_PACKAGE_NAME.equals(ops.getPackageName());
    if (!isAndroidOs && ActivityManager.getCurrentUser() == UserHandle.getUserId(uid)) {
      Preference pref=getPreferenceFromOps(now,ops);
      if (pref != null) {
        prefs.add(pref);
      }
    }
  }
  return prefs;
}
