{
  boolean modified=false;
  NetworkPolicy policy=getPolicy(template);
  if (metered) {
    if (policy == null) {
      policy=buildDefaultPolicy(template);
      policy.metered=true;
      policy.inferred=false;
      mPolicies.add(policy);
      modified=true;
    }
 else     if (!policy.metered) {
      policy.metered=true;
      policy.inferred=false;
      modified=true;
    }
  }
 else {
    if (policy == null) {
    }
 else     if (policy.metered) {
      policy.metered=false;
      policy.inferred=false;
      modified=true;
    }
  }
  final NetworkTemplate unquoted=buildUnquotedNetworkTemplate(template);
  final NetworkPolicy unquotedPolicy=getPolicy(unquoted);
  if (unquotedPolicy != null) {
    mPolicies.remove(unquotedPolicy);
    modified=true;
  }
  if (modified)   writeAsync();
}
