{
  boolean modified=false;
  NetworkPolicy policy=getPolicy(template);
  if (metered) {
    if (policy == null) {
      policy=buildDefaultPolicy(template);
      policy.metered=true;
      policy.inferred=false;
      mPolicies.add(policy);
      modified=true;
    }
 else     if (!policy.metered) {
      policy.metered=true;
      policy.inferred=false;
      modified=true;
    }
  }
 else {
    if (policy == null) {
    }
 else     if (policy.template.getMatchRule() == MATCH_WIFI && policy.warningBytes == WARNING_DISABLED && policy.limitBytes == LIMIT_DISABLED) {
      mPolicies.remove(policy);
      modified=true;
    }
 else     if (policy.metered) {
      policy.metered=false;
      policy.inferred=false;
      modified=true;
    }
  }
  if (modified)   writeAsync();
}
