{
  boolean modified=false;
  NetworkPolicy policy=getPolicy(template);
  if (metered) {
    if (policy == null) {
      policy=buildDefaultPolicy(template);
      policy.metered=true;
      policy.inferred=false;
      mPolicies.add(policy);
      modified=true;
    }
 else     if (!policy.metered) {
      policy.metered=true;
      policy.inferred=false;
      modified=true;
    }
  }
 else {
    if (policy == null) {
    }
 else     if (policy.metered) {
      policy.metered=false;
      policy.inferred=false;
      modified=true;
    }
  }
  final String networkId=template.getNetworkId();
  final String strippedNetworkId=WifiInfo.removeDoubleQuotes(networkId);
  if (!TextUtils.equals(strippedNetworkId,networkId)) {
    policy=getPolicy(new NetworkTemplate(template.getMatchRule(),template.getSubscriberId(),strippedNetworkId));
    if (policy != null) {
      mPolicies.remove(policy);
      modified=true;
    }
  }
  if (modified)   writeAsync();
}
