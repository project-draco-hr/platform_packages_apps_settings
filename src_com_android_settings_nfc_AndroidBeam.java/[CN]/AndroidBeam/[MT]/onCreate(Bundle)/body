{
  super.onCreate(savedInstanceState);
  Activity activity=getActivity();
  mActionBarSwitch=new Switch(activity);
  if (activity instanceof PreferenceActivity) {
    final int padding=activity.getResources().getDimensionPixelSize(R.dimen.action_bar_switch_padding);
    mActionBarSwitch.setPaddingRelative(0,0,padding,0);
    activity.getActionBar().setDisplayOptions(ActionBar.DISPLAY_SHOW_CUSTOM,ActionBar.DISPLAY_SHOW_CUSTOM);
    activity.getActionBar().setCustomView(mActionBarSwitch,new ActionBar.LayoutParams(ActionBar.LayoutParams.WRAP_CONTENT,ActionBar.LayoutParams.WRAP_CONTENT,Gravity.CENTER_VERTICAL | Gravity.END));
    mOldActivityTitle=activity.getActionBar().getTitle();
    activity.getActionBar().setTitle(R.string.android_beam_settings_title);
  }
  mActionBarSwitch.setOnCheckedChangeListener(this);
  mNfcAdapter=NfcAdapter.getDefaultAdapter(getActivity());
  mActionBarSwitch.setChecked(mNfcAdapter.isNdefPushEnabled());
}
