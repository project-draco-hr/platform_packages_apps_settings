{
  String key=preference.getKey();
  if (key != null && key.contains(DELIMITER)) {
    StringTokenizer st=new StringTokenizer(key,DELIMITER);
    final String packageName=st.nextToken();
    final String restrictionKey=st.nextToken();
    AppRestrictionsPreference appPref=(AppRestrictionsPreference)mAppList.findPreference(PKG_PREFIX + packageName);
    ArrayList<RestrictionEntry> restrictions=appPref.getRestrictions();
    if (restrictions != null) {
      for (      RestrictionEntry entry : restrictions) {
        if (entry.getKey().equals(restrictionKey)) {
switch (entry.getType()) {
case RestrictionEntry.TYPE_BOOLEAN:
            entry.setSelectedState((Boolean)newValue);
          break;
case RestrictionEntry.TYPE_CHOICE:
case RestrictionEntry.TYPE_CHOICE_LEVEL:
        ListPreference listPref=(ListPreference)preference;
      entry.setSelectedString((String)newValue);
    String readable=findInArray(entry.getChoiceEntries(),entry.getChoiceValues(),(String)newValue);
  listPref.setSummary(readable);
break;
case RestrictionEntry.TYPE_MULTI_SELECT:
MultiSelectListPreference msListPref=(MultiSelectListPreference)preference;
Set<String> set=(Set<String>)newValue;
String[] selectedValues=new String[set.size()];
set.toArray(selectedValues);
entry.setAllSelectedStrings(selectedValues);
break;
default :
continue;
}
if (packageName.equals(getActivity().getPackageName())) {
RestrictionUtils.setRestrictions(getActivity(),restrictions,mUser);
}
 else {
mUserManager.setApplicationRestrictions(packageName,RestrictionUtils.restrictionsToBundle(restrictions),mUser);
}
break;
}
}
}
}
 else if (preference == mUserPreference) {
String userName=((CharSequence)newValue).toString();
if (!TextUtils.isEmpty(userName)) {
mUserManager.setUserName(mUser.getIdentifier(),userName);
mUserPreference.setTitle(userName);
}
}
return true;
}
