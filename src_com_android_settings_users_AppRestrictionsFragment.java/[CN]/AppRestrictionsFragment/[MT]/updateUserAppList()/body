{
  IPackageManager ipm=IPackageManager.Stub.asInterface(ServiceManager.getService("package"));
  final int userId=mUser.getIdentifier();
  if (!mUserManager.getUserInfo(userId).isRestricted()) {
    Log.e(TAG,"Cannot apply application restrictions on a regular user!");
    return;
  }
  for (  Map.Entry<String,Boolean> entry : mSelectedPackages.entrySet()) {
    String packageName=entry.getKey();
    if (entry.getValue()) {
      try {
        ApplicationInfo info=ipm.getApplicationInfo(packageName,0,userId);
        if (info == null || info.enabled == false) {
          ipm.installExistingPackageAsUser(packageName,mUser.getIdentifier());
          if (DEBUG) {
            Log.d(TAG,"Installing " + packageName);
          }
        }
      }
 catch (      RemoteException re) {
      }
    }
 else {
      try {
        ApplicationInfo info=ipm.getApplicationInfo(packageName,0,userId);
        if (info != null) {
          ipm.deletePackageAsUser(entry.getKey(),null,mUser.getIdentifier(),PackageManager.DELETE_SYSTEM_APP);
          if (DEBUG) {
            Log.d(TAG,"Uninstalling " + packageName);
          }
        }
      }
 catch (      RemoteException re) {
      }
    }
  }
}
