{
  if (getActivity() == null)   return;
  List<UserInfo> users=mUserManager.getUsers(true);
  mUserListCategory.removeAll();
  mUserListCategory.setOrderingAsAdded(false);
  final ArrayList<Integer> missingIcons=new ArrayList<Integer>();
  for (  UserInfo user : users) {
    Preference pref;
    if (user.id == mRemovingUserId) {
      continue;
    }
 else     if (user.id == UserHandle.myUserId()) {
      pref=mMePreference;
      mNicknamePreference.setText(user.name);
      mNicknamePreference.setSummary(user.name);
    }
 else {
      pref=new UserPreference(getActivity(),null,user.id,UserHandle.myUserId() == UserHandle.USER_OWNER,this);
      pref.setOnPreferenceClickListener(this);
      pref.setKey("id=" + user.id);
      mUserListCategory.addPreference(pref);
      if (user.id == UserHandle.USER_OWNER) {
        pref.setSummary(R.string.user_owner);
      }
      pref.setTitle(user.name);
      if (!isInitialized(user)) {
        pref.setSummary(R.string.user_summary_not_set_up);
      }
    }
    if (user.iconPath != null) {
      if (mUserIcons.get(user.id) == null) {
        missingIcons.add(user.id);
        pref.setIcon(R.drawable.ic_user);
      }
 else {
        setPhotoId(pref,user);
      }
    }
  }
  if (mAddingUser) {
    Preference pref=new UserPreference(getActivity(),null,UserPreference.USERID_UNKNOWN,false,null);
    pref.setEnabled(false);
    pref.setTitle(R.string.user_new_user_name);
    pref.setSummary(R.string.user_adding_new_user);
    pref.setIcon(R.drawable.ic_user);
    mUserListCategory.addPreference(pref);
  }
  getActivity().invalidateOptionsMenu();
  if (missingIcons.size() > 0) {
    loadIconsAsync(missingIcons);
  }
}
