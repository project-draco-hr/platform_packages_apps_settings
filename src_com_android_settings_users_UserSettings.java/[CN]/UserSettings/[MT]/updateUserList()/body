{
  if (getActivity() == null)   return;
  List<UserInfo> users=mUserManager.getUsers(true);
  mTrustedUserListCategory.removeAll();
  mTrustedUserListCategory.setOrderingAsAdded(false);
  mLimitedUserListCategory.removeAll();
  mLimitedUserListCategory.setOrderingAsAdded(false);
  final ArrayList<Integer> missingIcons=new ArrayList<Integer>();
  for (  UserInfo user : users) {
    Preference pref;
    if (user.id == UserHandle.myUserId()) {
      pref=mMePreference;
      mNicknamePreference.setText(user.name);
      mNicknamePreference.setSummary(user.name);
    }
 else {
      pref=new UserPreference(getActivity(),null,user.id,UserHandle.myUserId() == UserHandle.USER_OWNER,this,this);
      pref.setOnPreferenceClickListener(this);
      pref.setKey("id=" + user.id);
      if (user.isRestricted()) {
        mLimitedUserListCategory.addPreference(pref);
      }
 else {
        mTrustedUserListCategory.addPreference(pref);
      }
      if (user.id == UserHandle.USER_OWNER) {
        pref.setSummary(R.string.user_owner);
      }
      pref.setTitle(user.name);
      if (!isInitialized(user)) {
        pref.setSummary(R.string.user_summary_not_set_up);
      }
    }
    if (user.iconPath != null) {
      if (mUserIcons.get(user.id) == null) {
        missingIcons.add(user.id);
        pref.setIcon(encircle(R.drawable.avatar_default_1));
      }
 else {
        setPhotoId(pref,user);
      }
    }
  }
  if (mAddingUser) {
    Preference pref=new UserPreference(getActivity(),null,UserPreference.USERID_UNKNOWN,false,null,null);
    pref.setEnabled(false);
    pref.setTitle(R.string.user_new_user_name);
    pref.setIcon(encircle(R.drawable.avatar_default_1));
    mTrustedUserListCategory.addPreference(pref);
  }
  getActivity().invalidateOptionsMenu();
  if (missingIcons.size() > 0) {
    loadIconsAsync(missingIcons);
  }
  boolean moreUsers=mUserManager.getMaxSupportedUsers() > users.size();
  mAddRestrictedUser.setEnabled(moreUsers);
  mAddTrustedUser.setEnabled(moreUsers);
  if (!mIsOwner) {
    if (mLimitedUserListCategory.getPreferenceCount() == 0) {
      removePreference(KEY_LIMITED_USER_LIST);
    }
  }
}
