{
  if (getActivity() == null)   return;
  List<UserInfo> users=mUserManager.getUsers(true);
  mUserListCategory.removeAll();
  mUserListCategory.setOrderingAsAdded(false);
  mUserListCategory.addPreference(mMePreference);
  final ArrayList<Integer> missingIcons=new ArrayList<Integer>();
  for (  UserInfo user : users) {
    Preference pref;
    if (user.id == UserHandle.myUserId()) {
      pref=mMePreference;
    }
 else {
      pref=new UserPreference(getActivity(),null,user.id,mIsOwner && user.isRestricted() ? this : null,mIsOwner ? this : null);
      pref.setOnPreferenceClickListener(this);
      pref.setKey("id=" + user.id);
      mUserListCategory.addPreference(pref);
      if (user.id == UserHandle.USER_OWNER) {
        pref.setSummary(R.string.user_owner);
      }
      pref.setTitle(user.name);
    }
    if (!isInitialized(user)) {
      pref.setSummary(user.isRestricted() ? R.string.user_summary_restricted_not_set_up : R.string.user_summary_not_set_up);
    }
 else     if (user.isRestricted()) {
      pref.setSummary(R.string.user_summary_restricted_profile);
    }
    if (user.iconPath != null) {
      if (mUserIcons.get(user.id) == null) {
        missingIcons.add(user.id);
        pref.setIcon(getDefaultCircleAvatar());
      }
 else {
        setPhotoId(pref,user);
      }
    }
  }
  if (mAddingUser) {
    Preference pref=new UserPreference(getActivity(),null,UserPreference.USERID_UNKNOWN,null,null);
    pref.setEnabled(false);
    pref.setTitle(R.string.user_new_user_name);
    pref.setIcon(getDefaultCircleAvatar());
    mUserListCategory.addPreference(pref);
  }
  getActivity().invalidateOptionsMenu();
  if (missingIcons.size() > 0) {
    loadIconsAsync(missingIcons);
  }
  boolean moreUsers=mUserManager.getMaxSupportedUsers() > users.size();
  mAddUser.setEnabled(moreUsers);
}
