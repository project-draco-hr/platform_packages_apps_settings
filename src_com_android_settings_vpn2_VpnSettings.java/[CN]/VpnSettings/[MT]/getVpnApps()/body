{
  List<AppVpnInfo> result=Lists.newArrayList();
  Set<Integer> currentProfileIds=new ArraySet<>();
  for (  UserHandle profile : mUserManager.getUserProfiles()) {
    currentProfileIds.add(profile.getIdentifier());
  }
  AppOpsManager aom=(AppOpsManager)getSystemService(Context.APP_OPS_SERVICE);
  List<AppOpsManager.PackageOps> apps=aom.getPackagesForOps(new int[]{OP_ACTIVATE_VPN});
  if (apps != null) {
    for (    AppOpsManager.PackageOps pkg : apps) {
      int userId=UserHandle.getUserId(pkg.getUid());
      if (!currentProfileIds.contains(userId)) {
        continue;
      }
      boolean allowed=false;
      for (      AppOpsManager.OpEntry op : pkg.getOps()) {
        if (op.getOp() == OP_ACTIVATE_VPN && op.getMode() == AppOpsManager.MODE_ALLOWED) {
          allowed=true;
        }
      }
      if (allowed) {
        result.add(new AppVpnInfo(userId,pkg.getPackageName()));
      }
    }
  }
  return result;
}
