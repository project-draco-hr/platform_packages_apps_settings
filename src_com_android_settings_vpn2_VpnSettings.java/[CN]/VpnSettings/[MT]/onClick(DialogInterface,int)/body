{
  if (button == DialogInterface.BUTTON_POSITIVE) {
    VpnProfile profile=mDialog.getProfile();
    mKeyStore.put(Credentials.VPN + profile.key,profile.encode());
    VpnPreference preference=mPreferences.get(profile.key);
    if (preference != null) {
      disconnect(profile.key);
      preference.update(profile);
    }
 else {
      preference=new VpnPreference(getActivity(),profile);
      preference.setOnPreferenceClickListener(this);
      mPreferences.put(profile.key,preference);
      getPreferenceScreen().addPreference(preference);
    }
    if (!mDialog.isEditing()) {
      try {
        connect(profile);
      }
 catch (      Exception e) {
        Log.e(TAG,"connect",e);
      }
    }
  }
}
