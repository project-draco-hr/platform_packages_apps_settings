{
  if (mDialog != null) {
    Log.v(TAG,"onPreferenceClick() is called when mDialog != null");
    return true;
  }
  if (preference instanceof VpnPreference) {
    VpnProfile profile=((VpnPreference)preference).getProfile();
    if (mInfo != null && profile.key.equals(mInfo.key) && mInfo.state == LegacyVpnInfo.STATE_CONNECTED) {
      try {
        mInfo.intent.send();
        return true;
      }
 catch (      Exception e) {
      }
    }
    mDialog=new VpnDialog(getActivity(),this,profile,false);
  }
 else {
    long millis=System.currentTimeMillis();
    while (mPreferences.containsKey(Long.toHexString(millis))) {
      ++millis;
    }
    mDialog=new VpnDialog(getActivity(),this,new VpnProfile(Long.toHexString(millis)),true);
  }
  mDialog.setOnDismissListener(this);
  mDialog.show();
  return true;
}
