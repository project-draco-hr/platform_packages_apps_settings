{
  PreferenceGroup vpnGroup=getPreferenceScreen();
  vpnGroup.removeAll();
  mConfigPreferences.clear();
  mAppPreferences.clear();
  for (  VpnProfile profile : loadVpnProfiles(mKeyStore)) {
    final ConfigPreference pref=new ConfigPreference(getActivity(),mManageListener,profile);
    pref.setOnPreferenceClickListener(this);
    mConfigPreferences.put(profile.key,pref);
    vpnGroup.addPreference(pref);
  }
  for (  AppOpsManager.PackageOps pkg : getVpnApps()) {
    final AppPreference pref=new AppPreference(getActivity(),mManageListener,pkg.getPackageName(),pkg.getUid());
    pref.setOnPreferenceClickListener(this);
    mAppPreferences.put(pkg.getPackageName(),pref);
    vpnGroup.addPreference(pref);
  }
  if (mUpdater == null) {
    mUpdater=new Handler(this);
  }
  mUpdater.sendEmptyMessage(0);
}
