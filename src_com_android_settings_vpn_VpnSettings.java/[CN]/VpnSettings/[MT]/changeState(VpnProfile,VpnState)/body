{
  VpnState oldState=p.getState();
  if (oldState == state)   return;
  Log.d(TAG,"changeState: " + p.getName() + ": "+ state);
  p.setState(state);
  mVpnPreferenceMap.get(p.getName()).setSummary(getProfileSummaryString(p));
switch (state) {
case CONNECTED:
    mActiveActor=null;
case CONNECTING:
  mActiveProfile=p;
disableProfilePreferencesIfOneActive();
break;
case DISCONNECTING:
if (oldState == VpnState.CONNECTING) {
mConnectingError=true;
}
break;
case CANCELLED:
changeState(p,VpnState.IDLE);
break;
case IDLE:
assert(mActiveProfile != p);
mActiveProfile=null;
mActiveActor=null;
enableProfilePreferences();
if (oldState == VpnState.CONNECTING) mConnectingError=true;
if (mConnectingError) showReconnectDialog(p);
break;
}
}
