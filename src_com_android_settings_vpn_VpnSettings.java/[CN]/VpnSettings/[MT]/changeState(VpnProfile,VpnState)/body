{
  VpnState oldState=p.getState();
  if (oldState == state)   return;
  p.setState(state);
  mVpnPreferenceMap.get(p.getName()).setSummary(getProfileSummaryString(p));
switch (state) {
case CONNECTED:
    mConnectingActor=null;
  mActiveProfile=p;
disableProfilePreferencesIfOneActive();
break;
case CONNECTING:
mConnectingActor=getActor(p);
case DISCONNECTING:
mActiveProfile=p;
disableProfilePreferencesIfOneActive();
break;
case CANCELLED:
changeState(p,VpnState.IDLE);
break;
case IDLE:
assert(mActiveProfile == p);
if (mConnectingErrorCode == NO_ERROR) {
onIdle();
}
 else {
showDialog(mConnectingErrorCode);
mConnectingErrorCode=NO_ERROR;
}
break;
}
}
