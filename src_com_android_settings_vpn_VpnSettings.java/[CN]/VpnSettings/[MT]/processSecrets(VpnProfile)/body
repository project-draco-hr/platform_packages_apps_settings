{
  Keystore ks=Keystore.getInstance();
switch (p.getType()) {
case L2TP_IPSEC_PSK:
    L2tpIpsecPskProfile pskProfile=(L2tpIpsecPskProfile)p;
  String keyName=KEY_PREFIX_IPSEC_PSK + p.getId();
String keyNameForDaemon=NAMESPACE_VPN + "_" + keyName;
String presharedKey=pskProfile.getPresharedKey();
if (!presharedKey.equals(keyNameForDaemon)) {
int ret=ks.put(NAMESPACE_VPN,keyName,presharedKey);
if (ret < 0) Log.e(TAG,"keystore write failed: key=" + keyName);
pskProfile.setPresharedKey(keyNameForDaemon);
}
case L2TP:
L2tpProfile l2tpProfile=(L2tpProfile)p;
keyName=KEY_PREFIX_L2TP_SECRET + p.getId();
if (l2tpProfile.isSecretEnabled()) {
keyNameForDaemon=NAMESPACE_VPN + "_" + keyName;
String secret=l2tpProfile.getSecretString();
if (!secret.equals(keyNameForDaemon)) {
int ret=ks.put(NAMESPACE_VPN,keyName,secret);
if (ret < 0) {
Log.e(TAG,"keystore write failed: key=" + keyName);
}
l2tpProfile.setSecretString(keyNameForDaemon);
}
}
 else {
ks.remove(NAMESPACE_VPN,keyName);
}
break;
}
}
