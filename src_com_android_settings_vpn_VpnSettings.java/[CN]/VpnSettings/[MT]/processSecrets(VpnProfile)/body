{
  Keystore ks=Keystore.getInstance();
switch (p.getType()) {
case L2TP_IPSEC_PSK:
    L2tpIpsecPskProfile pskProfile=(L2tpIpsecPskProfile)p;
  String presharedKey=pskProfile.getPresharedKey();
String keyName=KEY_PREFIX_IPSEC_PSK + p.getId();
if (!TextUtils.isEmpty(presharedKey)) {
int ret=ks.put(NAMESPACE_VPN,keyName,presharedKey);
if (ret != 0) {
  Log.e(TAG,"keystore write failed: key=" + keyName);
}
}
pskProfile.setPresharedKey(keyNameForDaemon(keyName));
case L2TP:
L2tpProfile l2tpProfile=(L2tpProfile)p;
keyName=KEY_PREFIX_L2TP_SECRET + p.getId();
if (l2tpProfile.isSecretEnabled()) {
String secret=l2tpProfile.getSecretString();
if (!TextUtils.isEmpty(secret)) {
int ret=ks.put(NAMESPACE_VPN,keyName,secret);
if (ret != 0) {
Log.e(TAG,"keystore write failed: key=" + keyName);
}
}
l2tpProfile.setSecretString(keyNameForDaemon(keyName));
}
 else {
ks.remove(NAMESPACE_VPN,keyName);
}
break;
}
}
