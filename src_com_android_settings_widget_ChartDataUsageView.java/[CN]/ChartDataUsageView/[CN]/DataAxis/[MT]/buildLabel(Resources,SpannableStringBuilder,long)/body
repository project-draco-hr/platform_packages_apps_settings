{
  final CharSequence unit;
  final long unitFactor;
  if (value < 1000 * MB_IN_BYTES) {
    unit=res.getText(com.android.internal.R.string.megabyteShort);
    unitFactor=MB_IN_BYTES;
  }
 else {
    unit=res.getText(com.android.internal.R.string.gigabyteShort);
    unitFactor=GB_IN_BYTES;
  }
  final double result=(double)value / unitFactor;
  final double resultRounded;
  final CharSequence size;
  if (result < 10) {
    size=String.format("%.1f",result);
    resultRounded=(unitFactor * Math.round(result * 10)) / 10;
  }
 else {
    size=String.format("%.0f",result);
    resultRounded=unitFactor * Math.round(result);
  }
  setText(builder,sSpanSize,size,"^1");
  setText(builder,sSpanUnit,unit,"^2");
  return (long)resultRounded;
}
