{
  final ContentResolver resolver=context.getContentResolver();
  new AsyncTask<Void,Void,Boolean>(){
    @Override protected Boolean doInBackground(    Void... args){
      final UserManager um=(UserManager)context.getSystemService(Context.USER_SERVICE);
      if (!um.hasUserRestriction(UserManager.DISALLOW_SHARE_LOCATION)) {
        Settings.Secure.setLocationMasterSwitchEnabled(resolver,desiredState);
        return desiredState;
      }
      return Settings.Secure.isLocationMasterSwitchEnabled(resolver);
    }
    @Override protected void onPostExecute(    Boolean result){
      setCurrentState(context,result ? STATE_ENABLED : STATE_DISABLED);
      updateWidget(context);
    }
  }
.execute();
}
