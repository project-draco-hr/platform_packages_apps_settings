{
  WifiManager wifiManager=(WifiManager)context.getSystemService(Context.WIFI_SERVICE);
  if (wifiManager == null) {
    Log.d(TAG,"No wifiManager.");
    return;
  }
  if (withToast) {
    Toast.makeText(context,R.string.gadget_toggle_wifi,Toast.LENGTH_SHORT).show();
  }
  int wifiApState=wifiManager.getWifiApState();
  if (desiredState && ((wifiApState == WifiManager.WIFI_AP_STATE_ENABLING) || (wifiApState == WifiManager.WIFI_AP_STATE_ENABLED))) {
    wifiManager.setWifiApEnabled(null,false);
  }
  wifiManager.setWifiEnabled(desiredState);
}
