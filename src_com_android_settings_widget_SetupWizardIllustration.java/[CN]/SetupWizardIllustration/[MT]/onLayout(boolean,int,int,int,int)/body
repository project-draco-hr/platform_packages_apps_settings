{
  final int layoutWidth=right - left;
  final int layoutHeight=bottom - top;
  if (mForeground != null) {
    int intrinsicWidth=mForeground.getIntrinsicWidth();
    int intrinsicHeight=mForeground.getIntrinsicHeight();
    final int layoutDirection=getLayoutDirection();
    mViewBounds.set(0,0,layoutWidth,layoutHeight);
    if (mAspectRatio != 0f) {
      mScale=layoutWidth / (float)intrinsicWidth;
      intrinsicWidth=layoutWidth;
      intrinsicHeight=(int)(intrinsicHeight * mScale);
    }
    Gravity.apply(Gravity.FILL_HORIZONTAL | Gravity.TOP,intrinsicWidth,intrinsicHeight,mViewBounds,mForegroundBounds,layoutDirection);
    mForeground.setBounds(mForegroundBounds);
  }
  if (mBackground != null) {
    mBackground.setBounds(0,0,(int)Math.ceil(layoutWidth / mScale),(int)Math.ceil((layoutHeight - mForegroundBounds.height()) / mScale));
  }
  super.onLayout(changed,left,top,right,bottom);
}
