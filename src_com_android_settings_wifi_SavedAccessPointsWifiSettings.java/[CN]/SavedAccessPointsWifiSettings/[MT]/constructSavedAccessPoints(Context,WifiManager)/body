{
  List<AccessPoint> accessPoints=new ArrayList<AccessPoint>();
  Map<String,List<ScanResult>> resultsMap=new HashMap<String,List<ScanResult>>();
  final List<WifiConfiguration> configs=wifiManager.getConfiguredNetworks();
  final List<ScanResult> scanResults=wifiManager.getScanResults();
  if (configs != null) {
    final int scanResultsSize=scanResults.size();
    for (int i=0; i < scanResultsSize; ++i) {
      final ScanResult result=scanResults.get(i);
      List<ScanResult> res=resultsMap.get(result.SSID);
      if (res == null) {
        res=new ArrayList<ScanResult>();
        resultsMap.put(result.SSID,res);
      }
      res.add(result);
    }
    final int configsSize=configs.size();
    for (int i=0; i < configsSize; ++i) {
      WifiConfiguration config=configs.get(i);
      if (config.selfAdded && config.numAssociation == 0) {
        continue;
      }
      AccessPoint accessPoint=new AccessPoint(context,config);
      final List<ScanResult> results=resultsMap.get(accessPoint.ssid);
      accessPoint.setShowSummary(false);
      if (results != null) {
        final int resultsSize=results.size();
        for (int j=0; j < resultsSize; ++j) {
          accessPoint.update(results.get(j));
          accessPoint.setIcon(null);
        }
      }
      accessPoints.add(accessPoint);
    }
  }
  return accessPoints;
}
