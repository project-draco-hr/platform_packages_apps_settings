{
  mConfigUi=parent;
  mInXlSetupWizard=(parent instanceof WifiConfigUiForSetupWizardXL);
  mView=view;
  mAccessPoint=accessPoint;
  mAccessPointSecurity=(accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.security;
  mEdit=edit;
  mTextViewChangedHandler=new Handler();
  mContext=mConfigUi.getContext();
  final Resources res=mContext.getResources();
  mLevels=res.getStringArray(R.array.wifi_signal);
  PHASE2_PEAP_ADAPTER=new ArrayAdapter<String>(mContext,android.R.layout.simple_spinner_item,res.getStringArray(R.array.wifi_peap_phase2_entries));
  PHASE2_PEAP_ADAPTER.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
  PHASE2_FULL_ADAPTER=new ArrayAdapter<String>(mContext,android.R.layout.simple_spinner_item,res.getStringArray(R.array.wifi_phase2_entries));
  PHASE2_FULL_ADAPTER.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
  unspecifiedCert=mContext.getString(R.string.wifi_unspecified);
  mIpSettingsSpinner=(Spinner)mView.findViewById(R.id.ip_settings);
  mIpSettingsSpinner.setOnItemSelectedListener(this);
  mProxySettingsSpinner=(Spinner)mView.findViewById(R.id.proxy_settings);
  mProxySettingsSpinner.setOnItemSelectedListener(this);
  if (mAccessPoint == null) {
    mConfigUi.setTitle(R.string.wifi_add_network);
    mSsidView=(TextView)mView.findViewById(R.id.ssid);
    mSsidView.addTextChangedListener(this);
    mSecuritySpinner=((Spinner)mView.findViewById(R.id.security));
    mSecuritySpinner.setOnItemSelectedListener(this);
    if (mInXlSetupWizard) {
      mView.findViewById(R.id.type_ssid).setVisibility(View.VISIBLE);
      mView.findViewById(R.id.type_security).setVisibility(View.VISIBLE);
      ArrayAdapter<String> adapter=new ArrayAdapter<String>(mContext,R.layout.wifi_setup_custom_list_item_1,android.R.id.text1,res.getStringArray(R.array.wifi_security_no_eap));
      mSecuritySpinner.setAdapter(adapter);
    }
 else {
      mView.findViewById(R.id.type).setVisibility(View.VISIBLE);
    }
    showIpConfigFields();
    showProxyFields();
    mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
    ((CheckBox)mView.findViewById(R.id.wifi_advanced_togglebox)).setOnCheckedChangeListener(this);
    mConfigUi.setSubmitButton(res.getString(R.string.wifi_save));
  }
 else {
    mConfigUi.setTitle(mAccessPoint.ssid);
    ViewGroup group=(ViewGroup)mView.findViewById(R.id.info);
    boolean showAdvancedFields=false;
    if (mAccessPoint.networkId != INVALID_NETWORK_ID) {
      WifiConfiguration config=mAccessPoint.getConfig();
      if (config.getIpAssignment() == IpAssignment.STATIC) {
        mIpSettingsSpinner.setSelection(STATIC_IP);
        showAdvancedFields=true;
      }
 else {
        mIpSettingsSpinner.setSelection(DHCP);
      }
      for (      InetAddress a : config.getLinkProperties().getAddresses()) {
        addRow(group,R.string.wifi_ip_address,a.getHostAddress());
      }
      if (config.getProxySettings() == ProxySettings.STATIC) {
        mProxySettingsSpinner.setSelection(PROXY_STATIC);
        showAdvancedFields=true;
      }
 else       if (config.getProxySettings() == ProxySettings.PAC) {
        mProxySettingsSpinner.setSelection(PROXY_PAC);
        showAdvancedFields=true;
      }
 else {
        mProxySettingsSpinner.setSelection(PROXY_NONE);
      }
    }
    if (mAccessPoint.networkId == INVALID_NETWORK_ID || mEdit) {
      showSecurityFields();
      showIpConfigFields();
      showProxyFields();
      mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
      ((CheckBox)mView.findViewById(R.id.wifi_advanced_togglebox)).setOnCheckedChangeListener(this);
      if (showAdvancedFields) {
        ((CheckBox)mView.findViewById(R.id.wifi_advanced_togglebox)).setChecked(true);
        mView.findViewById(R.id.wifi_advanced_fields).setVisibility(View.VISIBLE);
      }
    }
    if (mEdit) {
      mConfigUi.setSubmitButton(res.getString(R.string.wifi_save));
    }
 else {
      final DetailedState state=mAccessPoint.getState();
      final String signalLevel=getSignalString();
      if (state == null && signalLevel != null) {
        mConfigUi.setSubmitButton(res.getString(R.string.wifi_connect));
      }
 else {
        if (state != null) {
          addRow(group,R.string.wifi_status,Summary.get(mConfigUi.getContext(),state));
        }
        if (signalLevel != null) {
          addRow(group,R.string.wifi_signal,signalLevel);
        }
        WifiInfo info=mAccessPoint.getInfo();
        if (info != null && info.getLinkSpeed() != -1) {
          addRow(group,R.string.wifi_speed,info.getLinkSpeed() + WifiInfo.LINK_SPEED_UNITS);
        }
        if (info != null && info.getFrequency() != -1) {
          final int frequency=info.getFrequency();
          String band=null;
          if (frequency >= AccessPoint.LOWER_FREQ_24GHZ && frequency < AccessPoint.HIGHER_FREQ_24GHZ) {
            band=res.getString(R.string.wifi_band_24ghz);
          }
 else           if (frequency >= AccessPoint.LOWER_FREQ_5GHZ && frequency < AccessPoint.HIGHER_FREQ_5GHZ) {
            band=res.getString(R.string.wifi_band_5ghz);
          }
 else {
            Log.e(TAG,"Unexpected frequency " + frequency);
          }
          if (band != null) {
            addRow(group,R.string.wifi_frequency,band);
          }
        }
        addRow(group,R.string.wifi_security,mAccessPoint.getSecurityString(false));
        mView.findViewById(R.id.ip_fields).setVisibility(View.GONE);
      }
      if (mAccessPoint.networkId != INVALID_NETWORK_ID) {
        mConfigUi.setForgetButton(res.getString(R.string.wifi_forget));
      }
    }
  }
  if (mEdit || (mAccessPoint.getState() == null && mAccessPoint.getLevel() != -1)) {
    mConfigUi.setCancelButton(res.getString(R.string.wifi_cancel));
  }
 else {
    mConfigUi.setCancelButton(res.getString(R.string.wifi_display_options_done));
  }
  if (mConfigUi.getSubmitButton() != null) {
    enableSubmitIfAppropriate();
  }
}
