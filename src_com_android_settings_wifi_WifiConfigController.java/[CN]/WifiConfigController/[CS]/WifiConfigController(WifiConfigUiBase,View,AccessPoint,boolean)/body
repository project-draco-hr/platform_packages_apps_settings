{
  mConfigUi=parent;
  mInXlSetupWizard=(parent instanceof WifiConfigUiForSetupWizardXL);
  mView=view;
  mAccessPoint=accessPoint;
  mAccessPointSecurity=(accessPoint == null) ? AccessPoint.SECURITY_NONE : accessPoint.security;
  mEdit=edit;
  mTextViewChangedHandler=new Handler();
  final Context context=mConfigUi.getContext();
  final Resources resources=context.getResources();
  PHASE2_PEAP_ADAPTER=new ArrayAdapter<String>(context,android.R.layout.simple_spinner_item,context.getResources().getStringArray(R.array.wifi_peap_phase2_entries));
  PHASE2_PEAP_ADAPTER.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
  PHASE2_FULL_ADAPTER=new ArrayAdapter<String>(context,android.R.layout.simple_spinner_item,context.getResources().getStringArray(R.array.wifi_phase2_entries));
  PHASE2_FULL_ADAPTER.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item);
  unspecifiedCert=context.getString(R.string.wifi_unspecified);
  mIpSettingsSpinner=(Spinner)mView.findViewById(R.id.ip_settings);
  mIpSettingsSpinner.setOnItemSelectedListener(this);
  mProxySettingsSpinner=(Spinner)mView.findViewById(R.id.proxy_settings);
  mProxySettingsSpinner.setOnItemSelectedListener(this);
  if (mAccessPoint == null) {
    mConfigUi.setTitle(R.string.wifi_add_network);
    mSsidView=(TextView)mView.findViewById(R.id.ssid);
    mSsidView.addTextChangedListener(this);
    mSecuritySpinner=((Spinner)mView.findViewById(R.id.security));
    mSecuritySpinner.setOnItemSelectedListener(this);
    if (mInXlSetupWizard) {
      mView.findViewById(R.id.type_ssid).setVisibility(View.VISIBLE);
      mView.findViewById(R.id.type_security).setVisibility(View.VISIBLE);
      ArrayAdapter<String> adapter=new ArrayAdapter<String>(context,R.layout.wifi_setup_custom_list_item_1,android.R.id.text1,context.getResources().getStringArray(R.array.wifi_security_no_eap));
      mSecuritySpinner.setAdapter(adapter);
    }
 else {
      mView.findViewById(R.id.type).setVisibility(View.VISIBLE);
    }
    showIpConfigFields();
    showProxyFields();
    mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
    mView.findViewById(R.id.wifi_advanced_togglebox).setOnClickListener(this);
    mConfigUi.setSubmitButton(context.getString(R.string.wifi_save));
  }
 else {
    mConfigUi.setTitle(mAccessPoint.ssid);
    ViewGroup group=(ViewGroup)mView.findViewById(R.id.info);
    DetailedState state=mAccessPoint.getState();
    if (state != null) {
      addRow(group,R.string.wifi_status,Summary.get(mConfigUi.getContext(),state));
    }
    int level=mAccessPoint.getLevel();
    if (level != -1) {
      String[] signal=resources.getStringArray(R.array.wifi_signal);
      addRow(group,R.string.wifi_signal,signal[level]);
    }
    WifiInfo info=mAccessPoint.getInfo();
    if (info != null && info.getLinkSpeed() != -1) {
      addRow(group,R.string.wifi_speed,info.getLinkSpeed() + WifiInfo.LINK_SPEED_UNITS);
    }
    addRow(group,R.string.wifi_security,mAccessPoint.getSecurityString(false));
    boolean showAdvancedFields=false;
    if (mAccessPoint.networkId != INVALID_NETWORK_ID) {
      WifiConfiguration config=mAccessPoint.getConfig();
      if (config.ipAssignment == IpAssignment.STATIC) {
        mIpSettingsSpinner.setSelection(STATIC_IP);
        showAdvancedFields=true;
      }
 else {
        mIpSettingsSpinner.setSelection(DHCP);
      }
      for (      InetAddress a : config.linkProperties.getAddresses()) {
        addRow(group,R.string.wifi_ip_address,a.getHostAddress());
      }
      if (config.proxySettings == ProxySettings.STATIC) {
        mProxySettingsSpinner.setSelection(PROXY_STATIC);
        showAdvancedFields=true;
      }
 else {
        mProxySettingsSpinner.setSelection(PROXY_NONE);
      }
    }
    if (mAccessPoint.networkId == INVALID_NETWORK_ID || mEdit) {
      showSecurityFields();
      showIpConfigFields();
      showProxyFields();
      mView.findViewById(R.id.wifi_advanced_toggle).setVisibility(View.VISIBLE);
      mView.findViewById(R.id.wifi_advanced_togglebox).setOnClickListener(this);
      if (showAdvancedFields) {
        ((CheckBox)mView.findViewById(R.id.wifi_advanced_togglebox)).setChecked(true);
        mView.findViewById(R.id.wifi_advanced_fields).setVisibility(View.VISIBLE);
      }
    }
    if (mEdit) {
      mConfigUi.setSubmitButton(context.getString(R.string.wifi_save));
    }
 else {
      if (state == null && level != -1) {
        mConfigUi.setSubmitButton(context.getString(R.string.wifi_connect));
      }
 else {
        mView.findViewById(R.id.ip_fields).setVisibility(View.GONE);
      }
      if (mAccessPoint.networkId != INVALID_NETWORK_ID) {
        mConfigUi.setForgetButton(context.getString(R.string.wifi_forget));
      }
    }
  }
  mConfigUi.setCancelButton(context.getString(R.string.wifi_cancel));
  if (mConfigUi.getSubmitButton() != null) {
    enableSubmitIfAppropriate();
  }
}
