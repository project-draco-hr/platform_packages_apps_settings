{
  if (mStateMachineEvent) {
    return;
  }
  if (isChecked && !WirelessSettings.isRadioAllowed(mContext,Settings.Global.RADIO_WIFI)) {
    Toast.makeText(mContext,R.string.wifi_in_airplane_mode,Toast.LENGTH_SHORT).show();
    buttonView.setChecked(false);
  }
  int wifiApState=mWifiManager.getWifiApState();
  if (isChecked && ((wifiApState == WifiManager.WIFI_AP_STATE_ENABLING) || (wifiApState == WifiManager.WIFI_AP_STATE_ENABLED))) {
    mWifiManager.setWifiApEnabled(null,false);
  }
  if (isChecked == false) {
    if (mWifiManager.isScanAlwaysAvailable() && mNotifyScanMode.get()) {
      Intent intent=new Intent(WifiManager.ACTION_NOTIFY_SCAN_ALWAYS_AVAILABLE);
      mContext.startActivityAsUser(intent,null,UserHandle.CURRENT);
    }
  }
  if (mWifiManager.setWifiEnabled(isChecked)) {
    mSwitch.setEnabled(false);
  }
 else {
    Toast.makeText(mContext,R.string.wifi_error,Toast.LENGTH_SHORT).show();
  }
}
