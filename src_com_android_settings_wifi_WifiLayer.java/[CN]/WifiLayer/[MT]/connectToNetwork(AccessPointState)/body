{
  if (LOGV) {
    Log.v(TAG,"Connecting to " + state);
  }
  WifiConfiguration config=findConfiguredNetwork(state);
  if (LOGV) {
    Log.v(TAG," Found configured network " + config);
  }
  if (config == null) {
    config=addConfiguration(state,0);
    if (config == null) {
      Log.e(TAG,"Config is still null, even after attempting to add it.");
      error(R.string.error_connecting);
      return false;
    }
    ensureTrackingState(state);
  }
 else {
    state.updateWifiConfiguration(config);
  }
  if (!managerEnableNetwork(state,false)) {
    Log.e(TAG,"Could not enable network ID " + state.networkId);
    error(R.string.error_connecting);
    return false;
  }
  setHighestPriorityStateAndSave(state,config);
  mReenableApsOnNetworkStateChange=true;
  if (!managerEnableNetwork(state,true)) {
    Log.e(TAG,"Could not enable network ID " + state.networkId);
    error(R.string.error_connecting);
    return false;
  }
  if (LOGV) {
    Log.v(TAG," Enabled network " + state.networkId);
  }
  if (mCurrentSupplicantState == SupplicantState.DISCONNECTED || mCurrentSupplicantState == SupplicantState.SCANNING) {
    mWifiManager.reconnect();
  }
  if (!state.hasSecurity()) {
    checkForExcessOpenNetworks();
  }
  return true;
}
