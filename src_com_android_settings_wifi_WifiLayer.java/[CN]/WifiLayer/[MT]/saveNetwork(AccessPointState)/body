{
  WifiConfiguration config=findConfiguredNetwork(state);
  if (config == null) {
    state.setHiddenSsid(true);
    config=addConfiguration(state,ADD_CONFIGURATION_ENABLE);
    if (config == null) {
      Log.e(TAG,"Could not save configuration, call to addConfiguration failed.");
      error(R.string.error_saving);
      return false;
    }
  }
 else {
    state.updateWifiConfiguration(config);
    if (mWifiManager.updateNetwork(config) == -1) {
      Log.e(TAG,"Could not update configuration, call to WifiManager failed.");
      error(R.string.error_saving);
      return false;
    }
  }
  if (!managerSaveConfiguration()) {
    Log.e(TAG,"Could not save configuration, call to WifiManager failed.");
    error(R.string.error_saving);
    return false;
  }
  state.setNetworkId(AccessPointState.NETWORK_ID_ANY);
  config=findConfiguredNetwork(state);
  if (config != null) {
    state.setNetworkId(config.networkId);
  }
  ensureTrackingState(state);
  return true;
}
