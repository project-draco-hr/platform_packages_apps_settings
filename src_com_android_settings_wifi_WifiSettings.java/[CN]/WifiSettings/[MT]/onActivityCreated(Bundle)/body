{
  mWifiManager=(WifiManager)getSystemService(Context.WIFI_SERVICE);
  final Activity activity=getActivity();
  final Intent intent=activity.getIntent();
  mEnableNextOnConnection=intent.getBooleanExtra(EXTRA_ENABLE_NEXT_ON_CONNECT,false);
  if (mEnableNextOnConnection && hasNextButton()) {
    ConnectivityManager connectivity=(ConnectivityManager)getActivity().getSystemService(Context.CONNECTIVITY_SERVICE);
    if (connectivity != null) {
      NetworkInfo info=connectivity.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
      getNextButton().setEnabled(info.isConnected());
    }
  }
  if (intent.getBooleanExtra("only_access_points",false)) {
    addPreferencesFromResource(R.xml.wifi_access_points);
  }
 else {
    addPreferencesFromResource(R.xml.wifi_settings);
    mWifiEnabler=new WifiEnabler(activity,(CheckBoxPreference)findPreference("enable_wifi"));
    mNotifyOpenNetworks=(CheckBoxPreference)findPreference("notify_open_networks");
    mNotifyOpenNetworks.setChecked(Secure.getInt(getContentResolver(),Secure.WIFI_NETWORKS_AVAILABLE_NOTIFICATION_ON,0) == 1);
  }
  super.onActivityCreated(savedInstanceState);
  mAccessPoints=(ProgressCategory)findPreference("access_points");
  mAccessPoints.setOrderingAsAdded(false);
  mAddNetwork=findPreference("add_network");
  registerForContextMenu(getListView());
  setHasOptionsMenu(true);
}
