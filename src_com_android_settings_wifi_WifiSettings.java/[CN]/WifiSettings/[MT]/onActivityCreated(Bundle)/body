{
  mWifiManager=(WifiManager)getSystemService(Context.WIFI_SERVICE);
  mWifiManager.asyncConnect(getActivity(),new WifiServiceHandler());
  if (savedInstanceState != null && savedInstanceState.containsKey(SAVE_DIALOG_ACCESS_POINT_STATE)) {
    mDlgEdit=savedInstanceState.getBoolean(SAVE_DIALOG_EDIT_MODE);
    mAccessPointSavedState=savedInstanceState.getBundle(SAVE_DIALOG_ACCESS_POINT_STATE);
  }
  final Activity activity=getActivity();
  final Intent intent=activity.getIntent();
  mEnableNextOnConnection=intent.getBooleanExtra(EXTRA_ENABLE_NEXT_ON_CONNECT,false);
  if (mEnableNextOnConnection) {
    if (hasNextButton()) {
      final ConnectivityManager connectivity=(ConnectivityManager)getActivity().getSystemService(Context.CONNECTIVITY_SERVICE);
      if (connectivity != null) {
        NetworkInfo info=connectivity.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
        changeNextButtonState(info.isConnected());
      }
    }
  }
  if (mInXlSetupWizard) {
    addPreferencesFromResource(R.xml.wifi_access_points_for_wifi_setup_xl);
  }
 else {
    addPreferencesFromResource(R.xml.wifi_settings);
    Switch actionBarSwitch=new Switch(activity);
    if (activity instanceof PreferenceActivity) {
      PreferenceActivity preferenceActivity=(PreferenceActivity)activity;
      if (preferenceActivity.onIsHidingHeaders() || !preferenceActivity.onIsMultiPane()) {
        final int padding=activity.getResources().getDimensionPixelSize(R.dimen.action_bar_switch_padding);
        actionBarSwitch.setPadding(0,0,padding,0);
        activity.getActionBar().setDisplayOptions(ActionBar.DISPLAY_SHOW_CUSTOM,ActionBar.DISPLAY_SHOW_CUSTOM);
        activity.getActionBar().setCustomView(actionBarSwitch,new ActionBar.LayoutParams(ActionBar.LayoutParams.WRAP_CONTENT,ActionBar.LayoutParams.WRAP_CONTENT,Gravity.CENTER_VERTICAL | Gravity.RIGHT));
      }
    }
    mWifiEnabler=new WifiEnabler(activity,actionBarSwitch);
  }
  mEmptyView=(TextView)mView.findViewById(R.id.empty);
  getListView().setEmptyView(mEmptyView);
  registerForContextMenu(getListView());
  setHasOptionsMenu(true);
  super.onActivityCreated(savedInstanceState);
}
