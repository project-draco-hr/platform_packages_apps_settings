{
  super.onCreate(savedInstanceState);
  mWifiManager=(WifiManager)getSystemService(Context.WIFI_SERVICE);
  mEnableNextOnConnection=getIntent().getBooleanExtra(EXTRA_ENABLE_NEXT_ON_CONNECT,false);
  if (mEnableNextOnConnection && hasNextButton()) {
    ConnectivityManager connectivity=(ConnectivityManager)getApplicationContext().getSystemService(Context.CONNECTIVITY_SERVICE);
    if (connectivity != null) {
      NetworkInfo info=connectivity.getNetworkInfo(ConnectivityManager.TYPE_WIFI);
      getNextButton().setEnabled(info.isConnected());
    }
  }
  if (getIntent().getBooleanExtra("only_access_points",false)) {
    addPreferencesFromResource(R.xml.wifi_access_points);
  }
 else {
    addPreferencesFromResource(R.xml.wifi_settings);
    mWifiEnabler=new WifiEnabler(this,(CheckBoxPreference)findPreference("enable_wifi"));
    mNotifyOpenNetworks=(CheckBoxPreference)findPreference("notify_open_networks");
    mNotifyOpenNetworks.setChecked(Secure.getInt(getContentResolver(),Secure.WIFI_NETWORKS_AVAILABLE_NOTIFICATION_ON,0) == 1);
  }
  mAccessPoints=(ProgressCategory)findPreference("access_points");
  mAccessPoints.setOrderingAsAdded(false);
  mAddNetwork=findPreference("add_network");
  registerForContextMenu(getListView());
}
