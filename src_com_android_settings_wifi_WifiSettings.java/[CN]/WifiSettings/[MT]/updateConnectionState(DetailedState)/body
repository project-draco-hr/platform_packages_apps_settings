{
  if (state == DetailedState.OBTAINING_IPADDR) {
    mScanner.pause();
  }
 else {
    mScanner.resume();
  }
  mLastInfo=mWifiManager.getConnectionInfo();
  if (state != null) {
    mLastState=state;
  }
  for (int i=mAccessPoints.getPreferenceCount() - 1; i >= 0; --i) {
    ((AccessPoint)mAccessPoints.getPreference(i)).update(mLastInfo,mLastState);
  }
  if (mResetNetworks && (state == DetailedState.CONNECTED || state == DetailedState.DISCONNECTED || state == DetailedState.FAILED)) {
    updateAccessPoints();
    enableNetworks();
  }
}
