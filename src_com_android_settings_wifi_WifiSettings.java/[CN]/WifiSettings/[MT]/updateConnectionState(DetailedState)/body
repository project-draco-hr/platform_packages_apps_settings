{
  if (!mWifiManager.isWifiEnabled()) {
    mScanner.pause();
    return;
  }
  if (state == DetailedState.OBTAINING_IPADDR) {
    mScanner.pause();
  }
 else {
    mScanner.resume();
  }
  mLastInfo=mWifiManager.getConnectionInfo();
  if (state != null) {
    mLastState=state;
  }
  for (int i=mAccessPoints.getPreferenceCount() - 1; i >= 0; --i) {
    Preference preference=mAccessPoints.getPreference(i);
    if (preference instanceof AccessPoint) {
      final AccessPoint accessPoint=(AccessPoint)preference;
      accessPoint.update(mLastInfo,mLastState);
    }
  }
  final Activity activity=getActivity();
  if (activity instanceof WifiSettingsForSetupWizardXL) {
    if (mLastState == DetailedState.FAILED) {
      refreshAccessPoints();
    }
    ((WifiSettingsForSetupWizardXL)activity).updateConnectionState(mLastState);
  }
}
